
@model iFMIS_BMS.BusinessLayer.Models.Budget_Preparation.Cancelled
@using System.Globalization
@{
    var currencyMoney = Model.ProposalAmount;
    var displayMoney = string.Format(new CultureInfo("en-US"), "{0:N2}", currencyMoney);
}
<script>
    var thisculture = kendo.culture();
    thisculture.numberFormat.currency.symbol = '₱';
    $(document).ready(function () {
        $("#edit-button").click(function () {
            $("#displayMoney").hide();
            $("#edit-button").hide();
            $("#ProposalAmount").show();
            $("#submit-button").show();
        });

        var ProposalDenominationCode = @Model.ProposalDenominationCode;
        if(ProposalDenominationCode == 1){
            $("#edit-button").hide();
            $("#denomination-div").show();
        }else if(ProposalDenominationCode == 0){
            $("#denomination-div").hide();
            $("#edit-button").show();
        }


        $("#submit-button").click(function () {
            var url = "@Url.Action("SaveNewProgram", "Home")";
            //var Budget = $("#moneyUpdatedBudget").val();
            var Budget = document.getElementById("ProposalAmount").value;
            var ProposalID = document.getElementById("ProposalID").value;
            //alert(ProposalID);
            swal({
                title: "System Alert",
                text: "Account will be transfered for Approval. Do you want to Continue?",
                type: "warning",
                showCancelButton: true,
                confirmButtonColor: "#DD6B55",
                confirmButtonText: "Proceed",
                closeOnConfirm: false
            },
                function(){
                    $.get(url, { Budget: Budget, ProposalID: ProposalID }, function (d) {
                        if (d == 'success') {
                            swal('Success', 'Amount has been Updated!', 'success');
                            $("#displayMoney").show();
                            $("#edit-button").show();
                            $("#ProposalAmount").hide();
                            $("#submit-button").hide();
                            $("#grd_CancelledBudget").data("kendoGrid").dataSource.read();

                        } else {
                            swal('Error!', 'Something went wrong', 'error');
                        }
                    })

                });

        });
    });
    function CloseWindow() {
        //var Budget = $("#moneyUpdatedBudget").text();
        //alert(Budget);
        document.documentElement.style.overflow = 'auto';  // firefox, chrome
        document.body.scroll = "yes";
        $("#CancelledDetails").data("kendoWindow").close();
    }
    function SubmitUpdateProgramAccount(AccountID, ProgramID, ProposalYear, ProposalID, OfficeLevel) {
        var url = "@Url.Action("UpdateProgramAccount", "BudgetPreparation")";
        swal({
            title: "System Alert!",
            text: "This Action will Total all you Denomination and Update it as your Budget Proposal for the Selected Account. Click 'Ok' to Proceed.",
            type: "warning",
            showCancelButton: true,
            confirmButtonColor: "#DD6B55",
            confirmButtonText: "OK",
            closeOnConfirm: false
        }, function () {
            $.get(url, {AccountID: AccountID, ProgramID: ProgramID, ProposalYear: ProposalYear, ProposalID: ProposalID, OfficeLevel: OfficeLevel}, function(d) {
                if (d == "success") {

                    swal({
                        title: "Success!",
                        text: "Accounts Updated!.",
                        type: "success",
                        timer: 2000,
                        showConfirmButton: false
                    });
                    var gridName = "#grid_"+ @Model.AccountID;
                    $(gridName).data("kendoGrid").dataSource.read();
                }
            })
        });
    }
    function NewAccountsDenomination(AccountID, ProgramID, ProposalYear, ProposalStatusHR) {


            $(window).scrollTop(0);
            var ProgramID = ProgramID;
            var AccountID = AccountID;
            var ProposalYear = ProposalYear;
            var url = "@Url.Action("NewAccountDenomination", "BudgetPreparation")";
        $.get(url, { ProgramID: ProgramID, AccountID: AccountID, ProposalYear: ProposalYear }, function (d) {
            document.documentElement.style.overflow = 'hidden';  // firefox, chrome
            document.body.scroll = "no";
            $('#CreateNewDenominationAccount').html(d);
        });
        $('#CreateNewDenominationAccount').data('kendoWindow').title("<i class='fa fa-navicon'> </i>").center().open();


    }
</script>

<div style="width:101.5%;border-style: solid; border-color: #1fa67a;height:100%;margin:-7px;" >

    <div style="width:100%;height : 35px ; background-color:#1fa67a; color: white" >
        <h2 style="margin-left: 5px;color:white">Cancelled Account Details</h2>
    </div>
    <div style="padding:5px;" id="div-editable">
        <label><b> Account :</b> <span style="font-weight:200">@Model.AccountName</span> </label>
    </div>
    <div style="padding:5px" id="div-editable">
        <label><b> OOE :</b> <span style="font-weight:200"> @Model.OOE </span></label>
    </div>
    <div style="padding:5px;" id="div-editable">
        <label><b> Proposal Year :</b> <span style="font-weight:200"> @Model.ProposalYear </span></label>
    </div>
   
    <div style="padding:5px;" id="div-editable-money">
        <input type="text" id="ProposalID" name="ProposalID" value="@Model.ProposalID" style="display:none;">
        <label><b> Proposal Amount :</b> </label> <div style="padding:5px;padding-right:0px;">₱ <input type="text" id="ProposalAmount" name="ProposalAmount" value="@currencyMoney" style="display:none;"> <span style="font-weight:200" id="displayMoney" > @displayMoney </span> <button class="k-button k-state-active" id="edit-button"> Edit <i class="fa fa-edit"></i></button> <button class="k-button k-state-active" id="submit-button" style="display:none;"> Save Changes <i class="fa fa-save"></i></button></div>
    </div>
    <div style="padding:5px;" id="div-editable">
        <label><b> Reviewed By :</b> <span style="font-weight:200"> @Model.EmpName ( @Model.OfficeLevel )</span></label>
    </div>
    <div style="padding:5px;" id="div-editable">
        <label style="color:#ff0000"><b> Remarks :</b></label><div style="max-height:130px;overflow:auto;"><label> <span style="font-weight:200;margin-left:10px;"> @Model.Remarks </span> </label> </div>
    </div>
    <div id="denomination-div">
        @(Html.Kendo().Grid<iFMIS_BMS.BusinessLayer.Models.AccountDenomination>()
            .Name("grid_"+Model.AccountID) // template expression, to be evaluated in the master context

            .Columns(columns =>
            {
                columns.Bound(e => e.AccountDenominationID).Hidden();
                columns.Bound(e => e.DenominationName).Width(150);
                columns.Template(@<text></text>)
                        .HeaderTemplate(@<text>
            <div style="font-weight:600;">DenominationAmount</div></text>)
                        .Width(150)
                        .HtmlAttributes(new { style = "text-align:left" })
                        .HeaderHtmlAttributes(new { style = "text-align:left" })
                        .ClientTemplate("<div>#=kendo.toString(DenominationAmount, 'c2')# </div>");
                //columns.Bound(e => e.DenominationAmount).Width(150);
                columns.Template(@<text></text>)
                        .ClientTemplate(
                        "<div class='k-button' title='Edit Details (?)' onclick='EditData( #=AccountID# )'> Edit </div>" 
                        ).Width(60);
                columns.Template(@<text></text>)
                        .ClientTemplate(
                        "<div class='k-button' title='Delete (X)' onclick='DeleteData( #=AccountID# )'> Delete </div>"
                        ).Width(65);
            })
.ToolBar(t => t.Template(@<text>
                <div style="float: right; height:28px;margin-top:2px;">
                    <link href="~/Content/metroui/css/docs.css" rel="stylesheet" />

                    <div class="k-button" onclick="SubmitUpdateProgramAccount(@Model.AccountID, @Model.ProgramID, @Model.ProposalYear, @Model.ProposalID, '@Model.OfficeLevel')"><span class="fa fa-upload"></span> <b>Submit Denomination</b></div><div class="k-button" onclick="NewAccountsDenomination(@Model.AccountID, @Model.ProgramID, @Model.ProposalYear)"><span class="fa fa-plus-circle"></span> Add New Account Denomination </div> 
        @*<div class="k-button" onclick="SaveChanges('#=AccountID#')"><span class="fa fa-check"></span> Save Changes</div> <div class="k-button" onclick="CancelChanges('#=AccountID#')"><span class="fa fa-close"></span> Cancel Changes</div>*@
                </div>
</text>))
                                                       .Selectable()
                                                       .Pageable(page => page.Refresh(true)
                                                                 .Enabled(true)
                                                                 .ButtonCount(4)
                                                                 .PreviousNext(true))
                                                       .DataSource(dataSource => dataSource
                                                           //.Batch(true)
                                                           .Ajax()
                                                           //.Aggregates(aggregates => aggregates.Add(m => m.DenominationAmount).Sum())
                                                           .ServerOperation(false)

                                                           .PageSize(2)
                                                           .Model(m =>
                                                               {
                                                                   m.Id(i => i.AccountDenominationID);

                                                               })
                                                           .Read(read => read.Action("Proposal_AccountDenomination", "BudgetPreparation", new { ProgramID = Model.ProgramID, AccountID = Model.AccountID, ProposalYear = Model.ProposalYear }))
                                                   .Destroy(update => update.Action("EditingPopup_Destroy", "Grid"))
                                                       )
                                                       .Pageable()

        )
    </div>
    <a onclick="CloseWindow()">
        <div class="k-button k-state-active" style="padding:10px;float:right;padding-right:20px;padding-left:20px;"><i class="fa fa-sign-out" style="margin-right:10px;"></i>OK</div>
    </a>
</div>

@(Html.Kendo().Window()
    .Name("CreateNewDenominationAccount")
    .Title("Create New Denomination Account")
    .Width(450)
    .Height(250)
    .Visible(false)
    .Modal(true)
    .Draggable(false)
    .AutoFocus(true)
    .Events(e => e.Close("onClose"))
    .Animation(a =>
        {
            a.Open(o => o.SlideIn(SlideDirection.Down));
            a.Close(c =>
            {
                c.SlideIn(SlideDirection.Down);
                c.Reverse(true);
            });
        }).Actions(a => { a.Close(); }))

@(Html.Kendo().Window()
    .Name("EditDetails")
    .Title("Edit Account Denomination")
    .Width(450)
    .Height(250)
    .Visible(false)
    .Modal(true)
    .Draggable(false)
    .AutoFocus(true)
    .Events(e => e.Close("onClose"))
    .Animation(a =>
        {
            a.Open(o => o.Fade(FadeDirection.In));
            a.Close(c =>
            {
                c.Fade(FadeDirection.In);
                c.Reverse(true);
            });
        }).Actions(a => { a.Close(); }))
