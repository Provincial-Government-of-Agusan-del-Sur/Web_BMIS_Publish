@model iFMIS_BMS.BusinessLayer.Models.Budget_Preparation.Approved
<script>

    var thisculture = kendo.culture();
    thisculture.numberFormat.currency.symbol = '₱';

    var gridPastYear = @Model.BudgetYear - 2;
    var gridCurrentYear = @Model.BudgetYear - 1;
    var gridBudgetYear = @Model.BudgetYear;
    document.getElementById("pastYear").innerHTML = gridPastYear;
    document.getElementById("currentYear").innerHTML = gridCurrentYear;
    document.getElementById("budgetYear").innerHTML = gridBudgetYear;


    function Approve_params() {
        var programID = @Model.ProgramIDparams;
        var officeID = @Model.OfficeID;
        var proposalYear = @Model.BudgetYear;
        var OOE = $("#ooe_id").val();
        //alert(OOE);

        return {
            prog_ID: programID,
            OOE: OOE,
            proposalYear: proposalYear
        }
    }

    function read_OOE(){
        $("#grd_ApprovedBudget").data("kendoGrid").dataSource.read();
    }
    function searchAccount() {

        var SearchProgramData = $("#SearchData").val();
        $("#grd_ApprovedBudget").data("kendoGrid").dataSource.filter([
            {
                field: "AccountName",
                operator: "contains",
                value: SearchProgramData
            }
        ]);
    }

    $(function () {
        $("#SearchData").keypress(function (e) {
            if (e.keyCode == 13) {
                searchAccount();
            }
        });
    });

    function ViewHistory(ProposalID){
        $(window).scrollTop(0);
        var gridName = $('#grd_ApprovedBudget').data('kendoGrid');
        var dataRows = gridName.items();
        var rowIndex = dataRows.index(gridName.select());
        var ds = gridName.dataSource.view();
        var AccountName = ds[rowIndex].AccountName;
        var ProposalAmount = ds[rowIndex].ProposalAmount;
        var url = "@Url.Action("ViewHistoryAmount", "Home")";
        $.get(url, {ProposalID: ProposalID, AccountName: AccountName, ProposalAmount: ProposalAmount}, function (d) {
            document.documentElement.style.overflow = 'hidden';  // firefox, chrome
            document.body.scroll = "no";
            $('#ViewHistoryAmount').html(d);
        })
        $('#ViewHistoryAmount').data('kendoWindow').title("<i class='fa fa-navicon'> </i> Slashing Amount History").center().open();
    }

</script>
<style>
::-webkit-input-placeholder {
   font-style: italic;
}
:-moz-placeholder {
   font-style: italic;  
}
::-moz-placeholder {
   font-style: italic;  
}
:-ms-input-placeholder {  
   font-style: italic; 
}
</style>
<div style="width : 100%;margin-left:-5px;border-style: solid; border-color: #1fa67a;height:575px;">

    <div style="width:100%;height : 35px ; background-color:#1fa67a; color: white">
        <h2 style="margin-left: 5px;color:white"></h2>
    </div>
    <div style="padding:5px;margin-bottom:50px;">
        <div style="margin-top:20px;">
            <label>
                Expense Class : 
                @(Html.Kendo().DropDownList()
                        .Name("ooe_id")
                        .DataTextField("ooe_name")
                        .DataValueField("ooe_id")
                        .OptionLabel("Select Expenses...")
                        .Events(e => e.Change("read_OOE"))
                        .HtmlAttributes(new { @style = "width: 500px;" })
                        .DataSource(source => source.Read(read => read.Action("ddlOOE", "Dropdowns")))
                )
            </label>
        </div>
    @(Html.Kendo().Grid<iFMIS_BMS.BusinessLayer.Models.Budget_Preparation.Approved>()
    .Name("grd_ApprovedBudget")
    .Columns(col =>
    {
        col.Template(@<text></text>)
                        .HeaderTemplate(@<text><div style="font-weight:600;">Object of Expenditures</div></text>)
                        .Width(230)
                        .HtmlAttributes(new { style = "text-align:left;height:30px" })
                        .HeaderHtmlAttributes(new { style = "text-align:center" })
                        .ClientTemplate("<div> #=AccountName# </div>");
        col.Template(@<text></text>)
                        .HeaderTemplate(@<text><div style="font-weight:600;text-align:center; vertical-align: middle; overflow: visible; white-space: normal;">Account Code</div></text>)
                        .Width(50)
                        .HtmlAttributes(new { style = "text-align:center;height:30px" })
                        .HeaderHtmlAttributes(new { style = "text-align:center"})
                        .ClientTemplate("<div> #=AccountCode# </div>");
        col.Template(@<text></text>)
                        .HeaderTemplate(@<text><div style="font-weight:600;">Past Year <br/> <span id="pastYear"></span><br />(Actual)</div></text>)
                        .Width(100)
                        .HtmlAttributes(new { style = "text-align:right;height:30px"})
                        .HeaderHtmlAttributes(new { style ="text-align:center"})
                        .ClientTemplate("<div> #=kendo.toString(Actual_Year, 'c2')# </div>");
        col.Template(@<text></text>)
                        .HeaderTemplate(@<text><div style="font-weight:600">Current Year <br/> <span id="currentYear"></span><br/>(Estimates)</div></text>)
                        .Width(100)
                        .HtmlAttributes(new { style = "text-align:right;height:30px;" })
                        .HeaderHtmlAttributes(new { style="text-align:center"})
                        .ClientTemplate("<div> #=kendo.toString(Current_Year, 'c2')# </div>");
        col.Template(@<text></text>)
                        .HeaderTemplate(@<text><div style="font-weight:600">Budget Year <br/> <span id="budgetYear"></span><br/>(Proposed)</div></text>)
                        .Width(100)
                        .HtmlAttributes(new { style = "text-align:right;height:30px;" })
                        .HeaderHtmlAttributes(new { style="text-align:center"})
                        .ClientTemplate("<div> #=kendo.toString(Budget_Year, 'c2')# </div>");
        col.Bound(m => m.ProgramID).Title("Program ID").Hidden();
        col.Bound(m => m.AccountID).Title("Account ID").Hidden();
        col.Bound(m => m.ProposalDenominationCode).Title("Proposal Denomination Code").Hidden();
        col.Bound(m => m.ProposalYear).Title("ProposalYear").Hidden();
        col.Bound(m => m.ProposalAmount).Title("Proposal Amount").Hidden();
        col.Template(t => { }).ClientTemplate(
 "<div class='k-button' onclick='ViewHistory(#=ProposalID#,#=ProposalAmount#)' title='View Slashing History Amounts (?)'> <span class='fa fa-ticket'></span> History</div>"
 ).Width(30);
    })
           .ToolBar(toolbar =>
           {
              toolbar.Template(@<text>
                <div style="float: right; height:28px;margin-top:2px;">
                    <link href="~/Content/metroui/css/docs.css" rel="stylesheet" />
                    <div style="background-color:white;border:solid;border-color:whitesmoke;border-width:thin;width:310px;height:30px;float:right;padding:0px;margin-top:-3px;" id="search">
                        <input type="text" style="width:260px;border-collapse:collapse;border-color:white;margin:0px;margin-left:-10px;height:70%;outline:none;border-left-style:none;font-family:'Segoe UI Light_','Open Sans Light',Verdana,Arial,Helvetica,sans-serif;float:left;" placeholder="Search by Object of Expenditures" id="SearchData" name="SearchData">
                        <div class="k-button k-button-icontext" style="height:29px;width:40px;margin-top:0.6px;" onclick="searchAccount()"><span class="mif-search"></span></div>
                    </div>
                </div>
            </text>);
           })
       .Pageable(page => page.Refresh(true)
            .Enabled(true)
            .ButtonCount(4)
            .PreviousNext(true)
       )
       .Selectable()
       .DataSource(d => d
       .Ajax()
       .Batch(true)
       .PageSize(7)
       .Model(m => m.Id(i => i.AccountID))
             .Read(read => read.Action("BudgetInCharge_ApproveAccounts", "Home").Data("Approve_params")))
       )
       </div>
</div>
