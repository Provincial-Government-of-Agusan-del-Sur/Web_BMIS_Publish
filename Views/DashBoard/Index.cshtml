@model IEnumerable<iFMIS_BMS.BusinessLayer.Models.DashBoard.DashBoardModel>

<script>
    var d = new Date();
    var n = d.getFullYear() + 1;
    var ProjectedAmount = 199;
    var CurrentScrollPosition = $(window).scrollTop();
    var thisculture = kendo.culture();
    thisculture.numberFormat.currency.symbol = '₱'; //
    function getBudgetYear() {
        
        var ddlYear = $("#ddlYear").val();
        //alert(ddlYear)
        return {
            BudgetYear: ddlYear
        }
    }

    function ReloadChartData() {
        if ($('#ReloadSpiner').attr('class') == "fa fa-refresh") {
            $("#ReloadSpiner").removeClass("fa fa-refresh");
            $("#ReloadSpiner").addClass("fa fa-refresh fa-spin");
            $("#PieChartSourceOfFund").data("kendoChart").dataSource.read();
            $("#BarChartPvsP").data("kendoChart").dataSource.read();
            $("#PieChartPSMooeCA").data("kendoChart").dataSource.read();
            $("#PieChartPSMooe").data("kendoChart").dataSource.read();
            $("#PieChartAllOffices").data("kendoChart").dataSource.read();
            $("#BarChartOfficesWithProposal").data("kendoChart").dataSource.read();
            $("#PieChartPSMooeCAConsolidate").data("kendoChart").dataSource.read();
            $("#TotalFilledVacantPosition").data("kendoChart").dataSource.read();
            $("#PieChartAppropriationSumm").data("kendoChart").dataSource.read();

            $("#ReloadSpiner").removeClass("fa fa-refresh fa-spin");
            $("#ReloadSpiner").addClass("fa fa-refresh");

            var url = "@Url.Action("GetProposedTotalAmountAll", "Home")";
            var ddlYear = $("#ddlYear").val() == 0 ? 2021 : $("#ddlYear").val();
            $.post(url, { Yearof: ddlYear }, function (d) {
                document.getElementById('TotalProposedAmountAll').innerHTML = "Total Proposed Amount : ₱" + MoneyFormat(d)
                document.getElementById('TotalProposedAmountAll2').innerHTML = "Total Proposed Amount : ₱" + MoneyFormat(d)
            });
            var url = "@Url.Action("GetProposedTotalAmountNonOffice", "Home")";
            $.post(url, { Yearof: ddlYear }, function (dd) {
                document.getElementById('TotalProposedAmountAll3').innerHTML = "Total Non-Office Proposed Amount : ₱" + MoneyFormat(dd)
            });
            //
            var url = "@Url.Action("GetProposedTotalAmountAllConsol", "Home")";
            $.post(url, { Yearof: ddlYear }, function (dd) {
                document.getElementById('TotalProposedAmountAllConsol').innerHTML = "Total Consolidated Amount : ₱" + MoneyFormat(dd)
            });

            var url = "@Url.Action("TotalFilledVacantPosTotal", "Home")";
            $.post(url, { Yearof: ddlYear }, function (dd) {
                document.getElementById('TotalFilledVacantPos').innerHTML = "Total Filled-Up And Vacant Position Amount : ₱" + MoneyFormat(dd)
            });
            var url = "@Url.Action("TotalAppropriation", "Home")";
            $.post(url, { Yearof: ddlYear }, function (dd) {
                document.getElementById('AppropriationSummary').innerHTML = "Total Appropriation : ₱" + MoneyFormat(dd)
            });
        }
    }
    function OnSeriesClick(e) {
        CurrentScrollPosition = $(window).scrollTop()
        var ViewType = e.series.name
        if (ViewType == "Submitted" || ViewType == "With Proposal Not yet Submitted" || ViewType == "No Proposal") {
            var url = "@Url.Action("ShowOfficeListWindow", "DashBoard")";
            $('#OfficeListWindow').html('<div style="width: 100%;height:100%;"><img src="@Url.Content("~/Content/images/loading.gif")" alt="Loading..." style="position: absolute;top: 20%;left: 30%;margin-top: 0px;margin-left: 0px;" /></div>');
            $.post(url, { ViewType: ViewType }, function (pvData) {
                $(window).scrollTop(0);
                $('#OfficeListWindow').html(pvData);
                $('#OfficeListWindow').data('kendoWindow').title("<i class='fa fa-navicon'> </i> "+ ViewType +"").center().open();
            })
        }
    }
    function SetCurrentScrollPosition() {
        $(window).scrollTop(CurrentScrollPosition);
    }
  
</script>

<div style="float:right;display:inline-block; margin-top:5px">
    <label style="display:inline-block">Budget Year :
    @(Html.Kendo().ComboBox()
        .Name("ddlYear")
        .DataTextField("ProposalYear")
        .DataValueField("ProposalYear")
        .SelectedIndex(0)
        .HtmlAttributes(new { @style = "width: 90px;" })
        .Events(e => e.Change("ReloadChartData"))
        .DataSource(source => source.Read(read => read.Action("ddlProposalYearNew", "Dropdowns")))
    )

    </label>
    <button class="k-button" onclick="ReloadChartData()"> <i id="ReloadSpiner" class="fa fa-refresh"></i> Reload Chart Data </button>
</div>
<div style="display:inline-block;width:100%;border-color:#808080;border-style:solid;border-width:2px;display:none">
    @(Html.Kendo().Chart(Model)
        .Name("PieChartSourceOfFund")
        .Title(title => title
              .Text("PGAS General Fund")
              .Position(ChartTitlePosition.Top))
        .Legend(legend => legend
            .Visible(true)
            .Position(ChartLegendPosition.Bottom)
        )
        .Series(series =>
        {
            series.Pie(m => m.SourceOfFundsAmount, m => m.LegendSourceOfFunds).Labels(labels => labels
                .Template("#= category #: \n #=kendo.toString(value, 'c2')# ")
                .Background("transparent")
                .Visible(true)
                
                .Align(ChartPieLabelsAlign.Circle)
            ).Tooltip(tooltip => tooltip.Template("<div> #=kendo.toString(category)# : #=kendo.toString(value, 'c2')#  </div>").Visible(true)).StartAngle(100);
        })
                .DataSource(source => source.Read(read => read.Action("SourceOfFunds", "DashBoard").Data("getBudgetYear")))
    )
</div>
<br/>
<hr />
<div style="width:100%;border-color:#808080;border-style:solid;border-width:2px;margin-top:15px;">
    @(Html.Kendo().Chart(Model)
        .Name("BarChartPvsP")
        .Title(title => title
            .Text("PGAS Projected Budget vs. Proposed Budget")
            .Align(ChartTextAlignment.Center)
        )
        .Legend(legend => legend
            .Visible(true)
        )
        .Series(series =>
        {
            series.Column(model => model.col1)
                .Color("#007ADF")
                .Stack(true)
                .Visible(true)
                .Labels(l => l.Visible(false).Template("Projected </br> #=kendo.toString(value, 'c2')#"))
                .Name("Projected Budget ").Tooltip(template => template.Template("<div> Projected Budget : #=kendo.toString(value, 'c2')# </div>"));

            series.Column(model => model.col2)
                .Color("#dc5c71")
                .Stack(true)
                .Visible(true)
                .Labels(l => l.Visible(false).Template("Difference </br>  #=kendo.toString(value, 'c2')#"))
                .Name("Difference (Projected vs. Approved) ").Tooltip(template => template.Template("<div> Difference : #=kendo.toString(value, 'c2')# </div>"));

            series.Column(model => model.col3)
                .Color("#40D600")
                .Stack(true)
                .Visible(true)
                .Labels(l => l.Visible(false).Template("Approved </br> #=kendo.toString(value, 'c2')#"))
                .Name("Consolidated Budget ").Tooltip(template => template.Template("<div> Consolidated Budget : #=kendo.toString(value, 'c2')# </div>"));

           series.Column(model => model.col4)
                .Color("#E5FD00")
                .Stack(true)
                .Visible(true)
                .Labels(l => l.Visible(false).Template("Proposed </br> #=kendo.toString(value, 'c2')#"))
                .Name("Proposed Budget ").Tooltip(template => template.Template("<div> Proposed Budget : #=kendo.toString(value, 'c2')# </div>"));

        })
        .Tooltip(true)
        .CategoryAxis(axis => axis
            .Categories("Projected Amount","Consolidated Amount","Proposed Amount")
            .AxisCrossingValue(0, 0, 10, 10)
            .MajorGridLines(lines => lines.Visible(true))
        )
        .ValueAxis(axis => axis.Numeric()
            .Labels(labels => labels.Format("₱{0:N0}"))
            .Visible(true)
            .Min(0)
            .MajorUnit(200000000)
        )
        .Legend(l => l.Position(ChartLegendPosition.Bottom))
        .DataSource(source => source.Read(read => read.Action("ProjectedVsProposed", "DashBoard").Data("getBudgetYear")))
    ) 
</div>
<br/>
<div style="width:100%;border-color:#808080;border-style:solid;border-width:2px;">
    @(Html.Kendo().Chart(Model)
        .Name("PieChartPSMooeCA")
        .Title(title => title
              .Text("Proposed Personal Service, MOOE, Capital Outlay and Financial Expense")
              .Position(ChartTitlePosition.Top))
        .Legend(legend => legend
            .Visible(true)
            .Position(ChartLegendPosition.Top)
        )
        .Series(series =>
        {
            series.Pie(m => m.TotalPSMooeCA, m => m.LegendPiePSMooeCA ).Labels(labels => labels
                .Template("#= category #: \n #=kendo.toString(value, 'c2')# (#= kendo.format('{0:P4}', percentage)#)")
                .Background("transparent")
                .Visible(true)
            );
        })
        .Tooltip(tooltip => tooltip
            .Visible(true)
            .Format("{0:c2}")
        )
        .DataSource(source => source.Read(read => read.Action("TotalPSMooeCA", "DashBoard").Data("getBudgetYear")))
    )
       <span id="TotalProposedAmountAll" style="font-weight:600;margin-left: 420px; font-size:15px;margin-bottom: 20px"></span>

</div>
   
<br/>

<div style="width:100%;border-color:#808080;border-style:solid;border-width:2px;">
    @(Html.Kendo().Chart(Model)
        .Name("PieChartPSMooeCAConsolidate")
        .Title(title => title
              .Text("Consolidated Personal Service, MOOE and Capital Outlay")
              .Position(ChartTitlePosition.Top))
        .Legend(legend => legend
            .Visible(true)
            .Position(ChartLegendPosition.Top)
        )
        .Series(series =>
        {
            series.Pie(m => m.TotalPSMooeCA, m => m.LegendPiePSMooeCA ).Labels(labels => labels
                .Template("#= category #: \n #=kendo.toString(value, 'c2')# (#= kendo.format('{0:P4}', percentage)#)")
                .Background("transparent")
                .Visible(true)
            );
        })
        .Tooltip(tooltip => tooltip
            .Visible(true)
            .Format("{0:c2}")
        )
        .DataSource(source => source.Read(read => read.Action("TotalPSMooeCAConsolidated", "DashBoard").Data("getBudgetYear")))
    )
       <span id="TotalProposedAmountAllConsol" style="font-weight:600;margin-left: 420px; font-size:15px;margin-bottom: 20px"></span>

</div>
   
<br/>

<div style="width:100%;border-color:#808080;border-style:solid;border-width:2px;">
    @(Html.Kendo().Chart(Model)
        .Name("TotalFilledVacantPosition")
        .Title(title => title
              .Text("Filled-Up And Vacant Position")
              .Position(ChartTitlePosition.Top))
        .Legend(legend => legend
            .Visible(true)
            .Position(ChartLegendPosition.Top)
        )
        .Series(series =>
        {
            series.Pie(m => m.TotalPSMooeCA, m => m.LegendPiePSMooeCA ).Labels(labels => labels
                .Template("#= category #: \n #=kendo.toString(value, 'c2')# (#= kendo.format('{0:P4}', percentage)#)")
                .Background("transparent")
                .Visible(true)
            );
        })
        .Tooltip(tooltip => tooltip
            .Visible(true)
            .Format("{0:c2}")
        )
        .DataSource(source => source.Read(read => read.Action("TotalFilledVacantPosition", "DashBoard").Data("getBudgetYear")))
    )
       <span id="TotalFilledVacantPos" style="font-weight:600;margin-left: 305px; font-size:15px;margin-bottom: 20px"></span>

</div>
   
<br/>

<div style="width:100%;border-color:#808080;border-style:solid;border-width:2px;display:none">
    @(Html.Kendo().Chart(Model)
        .Name("PieChartPSMooe")
        .Title(title => title
              .Text("Proposed Personal Service and MOOE for Non-Office")
              .Position(ChartTitlePosition.Top))
        .Legend(legend => legend
            .Visible(true)
            .Position(ChartLegendPosition.Top)
        )
        .Series(series =>
        {
            series.Pie(m => m.TotalPSMooeCA, m => m.LegendPiePSMooeCA).Labels(labels => labels
                .Template("#= category #: \n #=kendo.toString(value, 'c2')# (#= kendo.format('{0:P4}', percentage)#)")
                .Background("transparent")
                .Visible(true)
            );
        })
        .Tooltip(tooltip => tooltip
            .Visible(true)
            .Format("{0:c2}")
        )
        .DataSource(source => source.Read(read => read.Action("TotalPSMooe", "DashBoard").Data("getBudgetYear")))
    )
<span id="TotalProposedAmountAll3" style="font-weight:600;margin-left: 340px; font-size:15px;margin-bottom: 20px"></span>
</div>
<br />

<div style="width:100%;border-color:#808080;border-style:solid;border-width:2px;">
    @(Html.Kendo().Chart(Model)
        .Name("PieChartAllOffices")
        .Title(title => title
              .Text("Proposed Per Office")
              .Position(ChartTitlePosition.Top))
        .Legend(legend => legend
            .Visible(false)
            .Position(ChartLegendPosition.Bottom)
        )
        .Series(series =>
        {
            series.Pie(m => m.TotalAmountOffice, m => m.OfficeLegend).Labels(labels => labels
                .Template("#= category #: \n #=kendo.toString(value, 'c2')# (#= kendo.format('{0:P4}', percentage)#)")
                .Background("transparent")
                .Visible(false)
                .Align(ChartPieLabelsAlign.Column)
            ).Tooltip(tooltip => tooltip.Template("<div> #=kendo.toString(category)# : #=kendo.toString(value, 'c2')# (#= kendo.format('{0:P4}', percentage)#) </div>").Visible(true));
        })
        .DataSource(source => source.Read(read => read.Action("TotalAllOffices", "DashBoard").Data("getBudgetYear")))
    )
<span id="TotalProposedAmountAll2" style="font-weight:600;margin-left: 420px; font-size:15px;margin-bottom: 20px"></span>

</div>
<br />

<div style="width:100%;border-color:#808080;border-style:solid;border-width:2px;">
    @(Html.Kendo().Chart(Model)
        .Name("PieChartAppropriationSumm")
        .Title(title => title
              .Text("Appropriation Summary")
              .Position(ChartTitlePosition.Top))
        .Legend(legend => legend
            .Visible(true)
            .Position(ChartLegendPosition.Top)
        )
        .Series(series =>
        {
            series.Pie(m => m.TotalAmountOffice, m => m.OfficeLegend).Labels(labels => labels
                .Template("#= category #: \n #=kendo.toString(value, 'c2')# (#= kendo.format('{0:P4}', percentage)#)")
                .Background("transparent")
                .Visible(true)
              //  .Align(ChartPieLabelsAlign.Column)
            ).Tooltip(tooltip => tooltip.Template("<div> #=kendo.toString(category)# : #=kendo.toString(value, 'c2')# (#= kendo.format('{0:P4}', percentage)#) </div>").Visible(true));
        })
        .DataSource(source => source.Read(read => read.Action("AppropriationSumm", "DashBoard").Data("getBudgetYear")))
    )
    <span id="AppropriationSummary" style="font-weight:600;margin-left: 420px; font-size:15px;margin-bottom: 20px"></span>

</div>
<br />

<div style="width:100%;border-color:#808080;border-style:solid;border-width:2px;">
    @(Html.Kendo().Chart(Model)
        .Name("BarChartOfficesWithProposal")
        .Title(title => title
            .Text("Office Proposals")
            .Align(ChartTextAlignment.Center)
        )
        .Legend(legend => legend
            .Visible(true)
        )
        .Series(series =>
        {
            series.Column(model => model.col1)
                .Color("#1fa67a")
                .Stack(true)
                .Visible(true)
                .Name("Submitted").Tooltip(template => template.Template("<div> Submitted : #=kendo.toString(value)# </div>"));

            series.Column(model => model.col2)
                .Color("#dc5c71")
                .Stack(true)
                .Visible(true)
                .Name("With Proposal Not yet Submitted").Tooltip(template => template.Template("<div> Not Yet Submitted : #=kendo.toString(value)# </div>"));

            series.Column(model => model.col3)
                .Color("#2A3535")
                .Stack(true)
                .Visible(true)
                .Name("No Proposal").Tooltip(template => template.Template("<div> No Proposal : #=kendo.toString(value)# </div>"));

            series.Column(model => model.col4)
                 .Color("#E5FD00")
                 .Stack(true)
                 .Visible(true)
                 .Name("Total No. Of Offices ").Tooltip(template => template.Template("<div> Total No. Of Offices : #=kendo.toString(value)# </div>"));

        })
        .Events(e => e.SeriesClick("OnSeriesClick"))
        .Tooltip(true)
        .CategoryAxis(axis => axis
            .Categories("Offices With Proposal", "Total No Of Offices")
            .AxisCrossingValue(0, 0, 10, 10)
            .MajorGridLines(lines => lines.Visible(true))
        )
        .ValueAxis(axis => axis.Numeric()
            .Labels(labels => labels.Format("{0:N0}"))
            .Visible(true)
            .Min(0)
            .MajorUnit(5)
        )
        .Legend(l => l.Position(ChartLegendPosition.Bottom))
        .DataSource(source => source.Read(read => read.Action("OfficesWithProposal", "DashBoard").Data("getBudgetYear")))
    )
</div>
 <div style="display:none">
    <input type="text" id="TotalProAmount" name="TotalProAmount" value="0" style="display:none;">
</div>
@(Html.Kendo().Window()
    .Name("OfficeListWindow")
    .Title("Office List")
    .Width(700)
    .Height(585)
    .Visible(false)
    .Modal(true)
    .Draggable(true)
    .AutoFocus(true)
    .Events(e=> e.Close("SetCurrentScrollPosition"))
    .Animation(a =>
        {
            a.Open(o => o.SlideIn(SlideDirection.Down));
            a.Close(c =>
            {
                c.SlideIn(SlideDirection.Down);
                c.Reverse(true);
            });
        }).Actions(a => { a.Close(); }))


<script>
    $(document).ready(function () {
        getBudgetYear();
        ReloadChartData();
        getAnnouncement();
        
    }, 1000);
    function getAnnouncement() {
        var url = "@Url.Action("getAnnouncement", "Announcement")";
        $.get(url, function (d) {
            if (d != 0) {
                var x = d.split('(J$()-XD=3h4N');
                $(window).scrollTop(0);
                $('#AnnouncementWindow').html(x[1]);
                $('#AnnouncementWindow').data('kendoWindow').title(x[0]).center().open();
            }
        })
    }

</script>


