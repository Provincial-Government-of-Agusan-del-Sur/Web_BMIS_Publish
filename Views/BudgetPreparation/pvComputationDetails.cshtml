@model iFMIS_BMS.BusinessLayer.Models.AccountComputationModel

<script>
    function reqCloseComputationDetails() {
        document.documentElement.style.overflow = 'auto';  // firefox, chrome
        document.body.scroll = "yes";
        $("#ComputationDetails").data("kendoWindow").close();
    }
    function ViewDetails(){
        var url2 = "@Url.Action("viewFormulaDetails", "BudgetPreparation")";

        var accountCode = @Model.AccountCode;
        var Amount = @Model.Amount;
        var ComputedAmount = @Model.ComputedAmount;
        var totalBasicSalary = @Model.totalBasicSalary;
        var isRoundof = @Model.isRoundOf;
        var maxAmount =@Model.MaxAmount;
        var Percentage = @Model.Percentage;


        $.get(url2,{AccountCode:accountCode, Amount:Amount, ComputedAmount:
        ComputedAmount, TotalBasicSalary: totalBasicSalary,isRoundof:
        isRoundof, maxAmount: maxAmount, Percentage:Percentage},function (pvData)
        {
            $(window).scrollTop(0);
            $('#FormulaDetails').html(pvData);
            $('#FormulaDetails').data('kendoWindow').title("<i class='fa fa-navicon'> </i> Computation Details").center().open();
        })
    }
    function getGridParam() {
        var selectedYear = @Session["selectedYear"] + 1;
        OfficeID = @Session["selectedOfficeID"];
        return{
            AccountCode: @Model.AccountCode,
            OfficeID:OfficeID,
            PropYear:selectedYear,
            AccountID: @Model.ComputationID,
        }
    }

    function reqAddCasual() {
        var url2 = "@Url.Action("ReqAddCasual", "BudgetPreparation")";
        $.get(url2,function (pvData)
        {
            $(window).scrollTop(0);
            $('#AddVacantCasual').html(pvData);
            $('#AddVacantCasual').data('kendoWindow').center().open();
        })
    }
    function reqTransferCasual() {
        var url2 = "@Url.Action("ReqTransferCasual", "BudgetPreparation")";
        var OfficeID = @Session["selectedOfficeID"];
        $.get(url2,{OfficeID: OfficeID},function (pvData)
        {
            $(window).scrollTop(0);
            $('#TransferCasual').html(pvData);
            $('#TransferCasual').data('kendoWindow').center().open();
        })
    }


</script>
<div style="width: 98%; margin-bottom: 55px;">
    <div style="width: 100%;height:100%">
        <label style="display:inline-block">Account Code : @Model.AccountCode</label>
        <div style="display:none">
            <div id="btnTransferCasual" class="k-button k-button-icontext" style="margin-right:5px;display:inline-block;width: 110px;clear:both; float:right" onclick="reqTransferCasual()">Transfer Casual</div>
            <div id="btnAddCasual" class="k-button k-button-icontext" style="margin-right:5px;margin-bottom:5px;display:inline-block;width: 110px;clear:both; float:right" onclick="reqAddCasual()">Vacant Casual</div>
        </div>
        <label>Account Name : @Model.AccountName</label>
        <div style="border:solid; border-color:#1fa67a ;width: 100%; height: 100%;display:inline-block;">
            <div style="margin-left: 5px; margin-bottom:10px;">
                <label>Formula</label>
                <span id="Amount"></span>
                <span id="Percentage"></span>
                <span id="Month"></span>
            </div>
            <div style="margin-left: 5px; margin-bottom:10px;">
                <label>Details</label>
                <span id="AmountValue"></span> <br />
                <span id="PercentageValue"></span><br />
                <span id="MonthValue"></span><br />
            </div>
            <div style="margin-left: 5px; margin-bottom:10px;">
                <span id="noteMax" style="color:red"></span>
            </div>
            <div style="margin-left: 5px; margin-bottom:10px;">
                <span id="noteRoundOff" style="color:red"></span>
            </div>
        </div>
    </div>
</div>
@(Html.Kendo().Grid<iFMIS_BMS.BusinessLayer.Models.Maintenance.PlantillaModel>()
        .Name("grdComputationDetail")
        .Columns(columns =>
        {
            columns.Bound(c => c.DivName).Title("EmploymentStatus").Hidden()
                .ClientGroupHeaderTemplate("<div style='display:inline-block'>#= value #</div>");
            columns.Bound(c => c.EmployeeName).Title("Name").Width(200)
                .HeaderHtmlAttributes(new { style = "text-align:center; vertical-align: middle; overflow: visible; white-space: normal" })
                .ClientGroupHeaderTemplate("<label style='display:inline-block'>: #=count#</label>")
                .ClientGroupFooterTemplate("<label style='display:inline-block'>Employee Count: #=count# </br> Sub Total</label>")
                .ClientFooterTemplate("<div style='color:darkgreen;'><Label>Employee Count : #=count# </label><label>Total Computation</label></div>");
            columns.Bound(c => c.YearlySalary).Title("Amount").Width(150)
                .HeaderHtmlAttributes(new { style = "text-align:center; vertical-align: middle; overflow: visible; white-space: normal" })
                .ClientGroupFooterTemplate("<label style='display:inline-block'>#=kendo.toString(sum, 'c2')#</label>")
                .ClientFooterTemplate("<div style='text-align:center;color:darkgreen'><label> </label><label> #=kendo.toString(sum, 'c2')#</label></div>");

        })
        .HtmlAttributes(new { style = "height: 300px;" })
        .Scrollable(s => s.Enabled(true))
        .Selectable()
        .DataSource(dataSource => dataSource
            .Ajax()
            .Batch(true)
            .ServerOperation(false)
            .Aggregates(a =>
            {
                a.Add(c => c.YearlySalary).Sum();
                a.Add(c => c.YearlySalary).Count();
                a.Add(c => c.EmployeeName).Count();
            })
            .Read(read => read.Action("grGetComputationDetails", "BudgetPreparation").Data("getGridParam"))
            .Group(g => g.Add(c => c.DivName))
        )
)
<div style="display:inline-block; float: right">
    <div id="btncloseComputationDetail" class="k-button k-button-icontext" style="margin-right:5px;display:inline-block;width: 80px;clear:both; margin-top: 10px" onclick="reqCloseComputationDetails()">Close</div>
</div>

@(Html.Kendo().Window()
    .Name("FormulaDetails")
    .Title("Formula Details")
    .Width(600)
    .Height(600)
    .Visible(false)
    .Modal(true)
    .Draggable(true)
    .AutoFocus(true)
    .Animation(a =>
    {
        a.Open(o => o.SlideIn(SlideDirection.Down));
        a.Close(c =>
        {
            c.SlideIn(SlideDirection.Down);
            c.Reverse(true);
        });
    }).Actions(a => { a.Close(); }))
@(Html.Kendo().Window()
    .Name("AddVacantCasual")
    .Title("Add Vacant Casual")
    .Width(540)
    .Height(300)
    .Visible(false)
    .Modal(true)
    .Draggable(true)
    .AutoFocus(true)
    .Animation(a =>
    {
        a.Open(o => o.SlideIn(SlideDirection.Down));
        a.Close(c =>
        {
            c.SlideIn(SlideDirection.Down);
            c.Reverse(true);
        });
    }).Actions(a => { a.Close(); }))

@(Html.Kendo().Window()
    .Name("TransferCasual")
    .Title("Transfer Casual")
    .Width(540)
    .Height(500)
    .Visible(false)
    .Modal(true)
    .Draggable(true)
    .AutoFocus(true)
    .Animation(a =>
    {
        a.Open(o => o.SlideIn(SlideDirection.Down));
        a.Close(c =>
        {
            c.SlideIn(SlideDirection.Down);
            c.Reverse(true);
        });
    }).Actions(a => { a.Close(); }))


<script>
    $(document).ready(function () {
        @using System.Globalization
        @{
    var ComputedAmount = "₱" + string.Format(new CultureInfo("en-US"), "{0:N2}", Model.ComputedAmount);
    var TotalBasicSalary = "₱" + string.Format(new CultureInfo("en-US"), "{0:N2}", Model.totalBasicSalary);
    var Amount = "₱" + string.Format(new CultureInfo("en-US"), "{0:N2}", Model.Amount);
    var MaxSalaryBase = string.Format(new CultureInfo("en-US"), "{0:N2}", Model.MaxAmount);

}
        if (@Model.AccountCode == 721) {
            var url = "@Url.Action("GetComputationDescription", "BudgetPreparation")";
            $.get(url, { OfficeID:@Session["selectedOfficeID"]} ,function (d) {
                document.getElementById('Amount').innerHTML = d
            })
            //document.getElementById('Amount').innerHTML = "((((Monthly * no of months) * Percentage) - (2000 * no of Months)) / 2) + (2000 * no of Months)"
        }
        else {
            if (@Model.Amount == 0) {
                document.getElementById('Amount').innerHTML = "Basic Salary";
                document.getElementById('AmountValue').innerHTML = "Employees Salary"
            }
            else {
                document.getElementById('Amount').innerHTML = "Given Amount(Constant)";
                document.getElementById('AmountValue').innerHTML = "Amount: @Model.Amount";
            }
            if (@Model.Month == 12) {
                document.getElementById('Month').innerHTML = "*Months";
                document.getElementById('MonthValue').innerHTML = "Month :@Model.Month";
            }
            else {
                document.getElementById('Month').innerHTML = "";
            }
            if (@Model.Percentage == 0) {
                document.getElementById('Percentage').innerHTML = "";
            }
            else {
                document.getElementById('Percentage').innerHTML = "*Percentage";
                document.getElementById('PercentageValue').innerHTML = "Percentage: @Model.Percentage"
            }
            if (@Model.MaxAmount == 0) {
                document.getElementById('noteMax').innerHTML = "";
            }
            else {
                document.getElementById('noteMax').innerHTML = "● Maximum Salary base is @MaxSalaryBase";
            }
            //hide on July 4, 2018 -xXx - no roundoff for philhealth computation
            //if (@Model.isRoundOf == 0  ) {
            //    document.getElementById('noteRoundOff').innerHTML = "";
            //}
            //else {
            //    document.getElementById('noteRoundOff').innerHTML = "● Salary base Less than @MaxSalaryBase are Rounded off (e.g. 24,999 = 24,000)";
            //}
            if (@Model.AccountCode == 705) {
                document.getElementById('btnAddCasual').style.display = "inline-block";
                document.getElementById('btnTransferCasual').style.display = "inline-block";
            }
            else {
                document.getElementById('btnAddCasual').style.display = "none";
                document.getElementById('btnTransferCasual').style.display = "none";
            }
        }
    })
</script>
