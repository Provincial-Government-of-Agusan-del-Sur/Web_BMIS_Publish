<script>
    function sup_Edits_trans(supplementaltransfere_id, DateTimeEntered) {
        var url = "@Url.Action("Edit_Supplement_transfere", "Release")";

        $.get(url, { supplementaltransfere_id: supplementaltransfere_id }, function (e) {
            document.getElementById("supplement_Subs_Ammount").value = commaSeparateNumberRealignment(e.Amount);
            document.getElementById("supplement_Subs_Ammount_DUM").value = e.Amount;
            $("#legalbasis_supplemental_null_subs").data("kendoComboBox").value(e.LegalCode);
            document.getElementById("supplement_Subs_Ammount_ID").value = e.supplementalbudget_id;

            $("#office_supplemental_null_subs").data("kendoComboBox").dataSource.read();
            $("#office_supplemental_null_subs").data("kendoComboBox").value(e.FMISOfficeCode);

            $("#Months_supplemental_null_subs").data("kendoDropDownList").value(e.MonthOf);
            $("#supdatetime").data("kendoDateTimePicker").value(DateTimeEntered);

            setTimeout(function () {


                $("#Program_supplemental_null_subs").data("kendoDropDownList").dataSource.read();

                setTimeout(function () {
                    $("#Program_supplemental_null_subs").data("kendoDropDownList").value(e.FMISProgramCode);
                }, 100);


            }, 100);
            setTimeout(function () {


                $("#ooe_id_supplemental_null_subs").data("kendoDropDownList").dataSource.read();


                setTimeout(function () {
                    $("#ooe_id_supplemental_null_subs").data("kendoDropDownList").value(e.OOECode);
                    setTimeout(function () {

                        $("#account_list_supplemental_null_subs").data("kendoComboBox").dataSource.read();


                        setTimeout(function () {
                            $("#account_list_supplemental_null_subs").data("kendoComboBox").value(e.FMISAccountCode);
                            grid_ref_sup_ok_subs();
                        }, 500);
                    }, 100);
                }, 100);


            }, 100);

        })
    }



    function delete_item_trans(supplementaltransfere_id) {
        var url = "@Url.Action("Edit_Supplement_transfere", "Release")";
        $.get(url, { supplementaltransfere_id: supplementaltransfere_id }, function (e) {
            document.getElementById("supplement_Subs_Ammount_DUM").value = e.Amount;
            setTimeout(function () {
                $("#account_list_supplemental_null_subs").data("kendoComboBox").value(e.FMISAccountCode);
                var url = "@Url.Action("datass", "Release")";
                var office_id = e.FMISOfficeCode
                var program_id = e.FMISProgramCode
                var account_id = e.FMISAccountCode
                var year_ = $("#ddlYear").val();
                if (account_id == 0 || account_id == null) {
                    document.getElementById("available_amount_null_SUP_sub").value = 0;
                } else {
                    $.post(url, { office_id: office_id, program_id: program_id, account_id: account_id, year_: year_ }, function (e) {
                        document.getElementById("available_amount_null_SUP_sub").value = commaSeparateNumberRealignment(e);
                    })
                }
            }, 100);

        })
    }

    function sup_Deletes_Transs(supplementaltransfere_id) {
        //delete_item_trans(supplementaltransfere_id);
        var url2 = "@Url.Action("Edit_Supplement_transfere", "Release")";
        
        $.get(url2, { supplementaltransfere_id: supplementaltransfere_id }, function (e) {
            document.getElementById("supplement_Subs_Ammount_DUM").value = e.Amount;
            setTimeout(function () {
                $("#account_list_supplemental_null_subs").data("kendoComboBox").value(e.FMISAccountCode);
                var url3 = "@Url.Action("datass", "Release")";

                var office_id = e.FMISOfficeCode
                var program_id = e.FMISProgramCode
                var account_id = e.FMISAccountCode
                var year_ = $("#ddlYear").val();
                if (account_id == 0 || account_id == null) {
                    document.getElementById("available_amount_null_SUP_sub").value = 0;
                } else {
                    $.post(url3, { office_id: office_id, program_id: program_id, ooe_id:0, account_id: account_id, year_: year_ }, function (e) {
                        document.getElementById("available_amount_null_SUP_sub").value = commaSeparateNumberRealignment(e);
                    
                    setTimeout(function () {
                        var url = "@Url.Action("delete_Supplement_Transfere", "Release")";

                        var supplement_amount = $('#supplement_Subs_Ammount').val()

                        var supplement_available = $('#available_amount_null_SUP_sub').val()
                        var supplement_amount_DUM = $('#supplement_Subs_Ammount_DUM').val()
                        var tobe_transfered = $('#total_tobe_transfere').val()
                        
                        if (Number(ConvertCommasToEmpty_realign(supplement_available)) < Number(ConvertCommasToEmpty_realign(supplement_amount_DUM))) {
                            document.getElementById("supplement_Subs_Ammount_DUM").value = 0;
                            document.getElementById("supplement_Subs_Ammount_ID").value = 0;
                            swal({
                                title: "Oops!",
                                text: "Not enough Amount...",
                                timer: 3000,
                                type: "error",
                                showConfirmButton: false
                            })
                        } else {

                            swal({
                                title: "Are you sure?",
                                text: "This item will be removed!",
                                type: "info",
                                showCancelButton: true,
                                closeOnConfirm: false,
                                confirmButtonColor: "#DD6B55",
                                confirmButtonText: "Yes, Remove It!",
                                showLoaderOnConfirm: true,
                            }, function () {

                                $.get(url, { supplementaltransfere_id: supplementaltransfere_id }, function (e) {

                                    if (e == "1") {
                                        swal({
                                            title: "Success!",
                                            text: "Item has been Removed.",
                                            timer: 2000,
                                            type: "success",
                                            showConfirmButton: false
                                        })

                                        grid_ref_sup_ok_subs();
                                        change_sup();
                                        get_total_transfere();
                                        $('#GeneralFund_Grid').data('kendoGrid').dataSource.read();
                                        $('#grd_Sups_List_subs_trans').data('kendoGrid').dataSource.read();
                                        document.getElementById("supplement_Subs_Ammount_DUM").value = 0;
                                        document.getElementById("supplement_Subs_Ammount_ID").value = 0;
                                        document.getElementById("supplement_Subs_Ammount").value = 0
                                        document.getElementById("available_amount_null_SUP_sub").value = 0;

                                    } else {
                                        swal({
                                            title: "Error!",
                                            text: "System Error! Please try again.",
                                            timer: 2000,
                                            type: "error",
                                            showConfirmButton: false
                                        })
                                    }

                                })
                            });
                        }
                    }, 200);
                        //}
                    })
                }
            }, 100);

        })
    }


    function ReadData_transf() {
        var LegalCode = $('#legalbasis_supplemental_null_subs').val()
        var office_id = $('#office_supplemental_null_subs').val()
        var program_id = $('#Program_supplemental_null_subs').val()
        var ooe_id = $('#ooe_id_supplemental_null_subs').val()
        var account_id = $('#account_list_supplemental_null_subs').val()
        var month_ = $('#Months_supplemental_null_subs').val()
        var year_ = $("#ddlYear").val();
        return {
            LegalCode: LegalCode,
            office_id: office_id,
            program_id: program_id,
            ooe_id: ooe_id,
            account_id: account_id,
            month_: month_,
            year_: year_
        }
    }

</script>

@(Html.Kendo().Grid<iFMIS_BMS.BusinessLayer.Models.Monthly_Supplement_Model>()
        .Name("grd_Sups_List_subs_trans")
    .Scrollable()
    .Columns(col =>
    {

        col.Bound(m => m.OfficeAbbrivation).HtmlAttributes(new { style = "text-align:left;height:30px" })
                            .HeaderTemplate(@<text><div style="font-weight:600;text-align:center; vertical-align: middle; overflow: visible; white-space: normal;">Office</div></text>)
                        .Width(60)
                        .HeaderHtmlAttributes(new { style = "text-align:center; vertical-align: middle; overflow: visible; white-space: normal" });

        col.Bound(m => m.AccountName).HtmlAttributes(new { style = "text-align:left;height:30px" })
                         .HeaderTemplate(@<text><div style="font-weight:600;text-align:center; vertical-align: middle; overflow: visible; white-space: normal;">Account Name</div></text>)
                        .Width(260)
                        .HeaderHtmlAttributes(new { style = "text-align:center; vertical-align: middle; overflow: visible; white-space: normal" })
                        .ClientFooterTemplate("<div style='text-align:center;color:darkgreen'><label> </label><label> Total Transfered Amount </label></div>");
        col.Bound(m => m.Amount)
                        .HtmlAttributes(new { style = "text-align:left;height:30px" })
                        .HeaderTemplate(@<text><div style="font-weight:600;text-align:center; vertical-align: middle; overflow: visible; white-space: normal;">Amount</div></text>)
                        .Width(110)
                        .HeaderHtmlAttributes(new { style = "text-align:center; vertical-align: middle; overflow: visible; white-space: normal" })
                        .ClientTemplate("<div>#=kendo.toString(Amount,'c2')# </div>")
                        .ClientFooterTemplate("<div style='text-align:center;color:darkgreen'><label> </label><label> #=kendo.toString(sum, 'c2')#</label></div>");

        col.Bound(m => m.MonthOf_).HtmlAttributes(new { style = "text-align:left;height:30px" })
                        .HeaderTemplate(@<text><div style="font-weight:600;text-align:center; vertical-align: middle; overflow: visible; white-space: normal;">Month</div></text>)
                        .Width(85)
                        .HeaderHtmlAttributes(new { style = "text-align:center; vertical-align: middle; overflow: visible; white-space: normal" });
        col.Bound(m => m.YearOf).HtmlAttributes(new { style = "text-align:left;height:30px" })
                        .HeaderTemplate(@<text><div style="font-weight:600;text-align:center; vertical-align: middle; overflow: visible; white-space: normal;">Year</div></text>)
                        .Width(55)
                        .HeaderHtmlAttributes(new { style = "text-align:center; vertical-align: middle; overflow: visible; white-space: normal" });
        col.Bound(m => m.DateTimeEntered).HtmlAttributes(new { style = "text-align:left;height:30px" })
                         .HeaderTemplate(@<text><div style="font-weight:600;text-align:center; vertical-align: middle; overflow: visible; white-space: normal;">Date and Time</div></text>)
                        .Width(160)
                        .HeaderHtmlAttributes(new { style = "text-align:center; vertical-align: middle; overflow: visible; white-space: normal" });
        // onclick='delete_float_EE(#=release_float_id#)'

        col.Template(t => { }).ClientTemplate(

                                      "<div class='k-button k-button-icontext' style='border-radius:50px;color:\\#ffffff;background-color:\\#1FA67A;'    onclick='sup_Edits_trans(#=supplementaltransfere_id#,\"#=DateTimeEntered#\")'   ><span class='fa fa-pencil-square-o' style='font-size: 10pt;margin: 1px;margin-top: -1px;margin-left: 5px;margin-right: 3px;'> </span>edit</div> " +
                                     "<div class='k-button k-button-icontext' style='border-radius:50px;color:\\#ffffff;background-color:\\#DE5555;'   onclick='sup_Deletes_Transs(#=supplementaltransfere_id#)'   ><span class='fa fa-trash-o' style='font-size: 10pt;margin: 1px;margin-top: -1px;margin-left: 5px;margin-right: 3px;'> </span>del</div> "
                                    ).HtmlAttributes(new { style = "vertical-align: top;" }).Width(160);

        col.Bound(m => m.supplementalbudget_id).HtmlAttributes(new { style = "text-align:left;height:30px" })
                        .HeaderTemplate(@<text><div style="font-weight:600;text-align:center; vertical-align: middle; overflow: visible; white-space: normal;">Traction ID</div></text>)
                        .Hidden()
                        .HeaderHtmlAttributes(new { style = "text-align:center; vertical-align: middle; overflow: visible; white-space: normal" });
    })

                            .Sortable()
                            .Scrollable()
                            .HtmlAttributes(new { style = "height:200px;" })
                            .DataSource(d => d
                                            .Ajax()
                                            .Aggregates(a =>
                                               {
                                                   a.Add(c => c.Amount).Sum();
                                               })
                                            .PageSize(1000)
                                            .Model(m => m.Id(i => i.supplementaltransfere_id))
                                            .Read(read => read.Action("Load_Supp_transf", "Release").Data("ReadData_transf")))
)


