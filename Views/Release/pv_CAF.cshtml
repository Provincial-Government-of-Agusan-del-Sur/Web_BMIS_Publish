@model IEnumerable<iFMIS_BMS.BusinessLayer.Models.DashBoard.DashBoardModel>
<script src="~/Scripts/BMS/Release/otherfunction.js"></script>
<script>
    function onData() {
        var program = $("#Progss").val();
        var account = $("#account_list").val();
        var ppaid =$("#account_list").val() == 2861? $("#subppa_list").val() : 0;
        var charge_office = $("#account_list").val() == 2861 ? 0 : $("#subppa_list").val();// $("#charge_office").val();
        var year = $("#ddlYear").val();
        var caftrans = $("#caftrans").val();
        
        return {
            program: program,
            account: account,
            ppaid: ppaid,
            charge_office: charge_office,
            year: year,
            caftrans: caftrans
        }
    }
    function getCafyear() {
        var year = $("#ddlYear").val();
        return {
            year: year,
            epaid: $("#epaid").val()
        }
    }
    var thisculture = kendo.culture();
    thisculture.numberFormat.currency.symbol = ' ';
</script>
<div style="width:100%;height : 35px ; background-color:#1fa67a; color: white">
    <h2 style="margin-left: 5px;color:white;font-size:25px"><i style="margin-bottom:5px;width:30px;height:27px" class="k-sprite fa fa-calendar-check-o"></i>  CERTIFICATE OF AVAILABILITY OF APPROPRIATION AND FUND</h2>
</div>
<div style="float: none;clear:both;margin-top:20px;">
    <div style="float: left;margin-left:90px;margin-top:2px;">
        <label style="float:left;margin-left: 50px;font-size:14px;">
            Office    :
        </label>
    </div>
    <div style="float: right;margin-right:130px;margin-top:0px;">
        @(Html.Kendo().ComboBox()
        .Name("offs")
        .DataTextField("OfficeName")
        .DataValueField("OfficeID")
        .Placeholder("Select office...")
        .Filter("contains")
        .MinLength(1)
        .HtmlAttributes(new { @style = "width: 400px;" })
        .Events(e => e.Change("fn_dprefresher"))
        .DataSource(source => source.Read(read => read.Action("GetOfficeAllFunds", "Release").Data("Select_exp")))
        )
    </div>
    <div style="float: left;margin-left:73.5px;margin-top:12px;">
        <label style="margin-left: 50px;margin-right: 5px;margin-top: 0px;margin-bottom: 2px;font-size:14px;">
            Program :
        </label>
    </div>
    <div style="float: left;margin-left:37.5px;margin-top:5px;">
        @(Html.Kendo().DropDownList()
        .Name("Progss")
        .DataTextField("ProgramDescription")
        .DataValueField("ProgramID")
        .OptionLabel("Select programs...")
        .HtmlAttributes(new { @style = "width: 400px;" })
        .Events(e => e.Change("fn_dprefresherprogs"))
        .DataSource(source => source.Read(read => read.Action("GetPrograms2", "dpPrograms").Data("fn_Offices")))
        )
    </div>
    
    <div style="float: left;margin-left:-552px;margin-top:42px;">
        <label style="margin-left: 50px;margin-right: 5px;margin-top: 0px;margin-bottom: 2px;font-size:14px;">
            Account    :
        </label>
    </div>
    <div style="float: left;margin-left:228.5px;margin-top:5px;">
        <script>
            function fn_ForAccount() {
                var propYear = $("#ddlYear").val();
                var prog_id = $("#Progss").val();
                return {
                    propYear: propYear,
                    prog_id: prog_id
                }
            }
        </script>

        @(Html.Kendo().ComboBox()
                        .Name("account_list")
                        .DataTextField("account_name")
                        .DataValueField("account_id")
                        .Filter("contains")
                        .MinLength(1)
                        .Placeholder("Select Account...")
                        .HtmlAttributes(new { @style = "width: 400px;" })
                        .Events(e => e.Change("ocake"))
                        .SelectedIndex(-1)
                        .DataSource(source => source.Read(read => read.Action("MOS_accountsNoMOOE", "Dropdowns").Data("fn_ForAccount")))
        )
    </div>
    <div id="chargeofficelabel" display="none"  style="float: left; margin-left: -587.5px; margin-top: 42px; display: inline;">
        <label style="margin-left: 50px;margin-right: 5px;margin-top: 0px;margin-bottom: 2px;font-size:14px;">
            Charge Office    :
        </label>
    </div>
    <div id="chargeoffice" display="none" style="float: left;margin-left:228.5px;margin-top:5px;">
       
        @(Html.Kendo().ComboBox()
        .Name("charge_office")
        .DataTextField("OfficeName")
        .DataValueField("OfficeID")
        .Placeholder("Select office...")
        .Filter("contains")
        .MinLength(1)
        .HtmlAttributes(new { @style = "width: 400px;" })
        .Events(e => e.Change("fn_computebalance"))
        .SelectedIndex(-1)
        .DataSource(source => source.Read(read => read.Action("GetOffice_MO", "Release").Data("Select_Office")))
        )
      
    </div>
    
    <div id="ppalabel" style="float: left; margin-left: -525px; margin-top: 43px;">
        <label style="margin-left: 50px;margin-right: 5px;margin-top: 0px;margin-bottom: 2px;font-size:14px;">
            PPA    :
        </label>
    </div>
    <div id="ppalist" style="float: left; margin-left: 228.5px; margin-top: 5px; display: inline;">
        @(Html.Kendo().ComboBox()
                        .Name("ppa_list")
                        .DataTextField("description")
                        .DataValueField("ppaid")
                        .Filter("contains")
                        .MinLength(1)
                        .Placeholder("Select PPA...")
                        .HtmlAttributes(new { @style = "width: 400px;" })
                        .Events(e => e.Change("onClickSubppa"))
                        .SelectedIndex(-1)
                        .DataSource(source => source.Read(read => read.Action("MainPPAdropdown", "Dropdowns").Data("fn_ForPPA")))
        )
    </div>

    <div id="subppalabel" style="float: left; margin-left: 73px; margin-top: 5px; display: inline;">
        <label style="margin-left: 50px;margin-right: 5px;margin-top: 0px;margin-bottom: 2px;font-size:14px;">
            Sub-PPA    :
        </label>
    </div>
    <div id="subppalist" style="float: right; margin-right: 129.5px; margin-top: 5px; display: inline;">

        @(Html.Kendo().ComboBox()
                        .Name("subppa_list")
                        .DataTextField("description")
                        .DataValueField("ppaid")
                        .Filter("contains")
                        .MinLength(1)
                        .Placeholder("Select Sub-PPA...")
                        .HtmlAttributes(new { @style = "width: 400px;" })
                        .Events(e => e.Change("fn_computebalance"))
                        .SelectedIndex(-1)
                        .DataSource(source => source.Read(read => read.Action("SubPPAdropdown", "Dropdowns").Data("fn_ForSubPPA")))
        )
    </div>
    <div style="float: left;margin-left:39px;margin-top:9px;">
        <label style="margin-left: 50px;margin-right: 5px;margin-top: 0px;margin-bottom: 2px;font-size:14px;">
            Appropriation    :
        </label>
    </div>
    <div style="float: left;margin-left:37px;margin-top:5px;">
        <input id="appamount" name="appamount" value="0.00" type="text" min="0" disabled style="width:139px;height:100%;font-size:16px;color:blue" class="form-control">
    </div>
    <div style="float: left;margin-left:-390px;margin-top:40px;">
        <label style="margin-left: 50px;margin-right: 5px;margin-top: 0px;margin-bottom: 2px;font-size:14px;">
            Total Release Amount    :
        </label>
        
    </div>
    <div style="float: left;margin-left:-150px;margin-top:38px;">
        <input id="totrelamount" name="totrelamount" value="0.00" type="text" min="0" disabled style="width:139px;height:100%;font-size:16px;color:red" class="form-control">
    </div>
    <div style="float: left;margin-left:-299px;margin-top:72px;">
        <label style="margin-left: 50px;margin-right: 5px;margin-top: 0px;margin-bottom: 2px;font-size:14px;">
            Balance    :
        </label>
    </div>
    <div style="float: left;margin-left:-150px;margin-top:72px;">
        <input id="balamount" name="balamount" value="0.00" type="text" min="0" disabled style="width:139px;height:100%;font-size:16px;color:green" class="form-control">
    </div>
    <div style="float: left;margin-left:-354px;margin-top:106px;">
        <label style="margin-left: 50px;margin-right: 5px;margin-top: 0px;margin-bottom: 2px;font-size:14px;">
            Release Amount    :
        </label>
    </div>
    <div style="float: left;margin-left:-150px;margin-top:106px;">
        <input id="relamount" name="relamount" value="0.00" type="number" min="0" style="width:139px;height:100%;font-size:16px;color:black" onkeyup="sync()" class="form-control">
    </div>
    <div style="float: left;margin-left:-278px;margin-top:141px;">
        <label style="margin-left: 50px;margin-right: 5px;margin-top: 0px;margin-bottom: 2px;font-size:14px;">
            Year    :
        </label>
    </div>
    <div style="text-align: right;float: left;margin-left:-150px;margin-top:140px;">
        @(Html.Kendo().DropDownList()
                        .Name("ddlYear")
                        .DataTextField("ProposalYear")
                        .DataValueField("ProposalYear")
                        .SelectedIndex(0)
                        .HtmlAttributes(new { @style = "width: 70px;text-align:left" })
                        .Events(e => e.Change("ocake"))
                        .DataSource(source => source.Read(read => read.Action("GetPropYear3", "PYear")))
        )
    </div>
    <div style="float: left;margin-left:-302.5px;margin-top:173px;">
        <label style="margin-left: 50px;margin-right: 5px;margin-top: 0px;margin-bottom: 2px;font-size:14px;">
            CAF No.    :
        </label>
    </div>
    <div style="text-align: right;float: left;margin-left:-150px;margin-top:174px;">
        @(Html.Kendo().ComboBox()
                        .Name("cafhistory")
                        .DataTextField("cafno")
                        .DataValueField("cafno")
                        .SelectedIndex(-1)
                        .HtmlAttributes(new { @style = "width: 139px;text-align:left" })
                        .DataSource(source => source.Read(read => read.Action("GetCAFHistory", "Release").Data("getCafyear")))
        )
        <div style="display:inline-block;"><input type="checkbox" value="0" id="epaid" style="zoom:1.3" title="Tick the box, to view the list of CAF number for EPA!"  onclick="epa_click()" /><b> EPA</b> </div>
        <div  class="k-button k-button-icontext" style="width: 30px;float:right;margin-right:-32px;margin-top:0px;background-color:#0094ff;color:white;border-radius:6px" title="Click this button to print CAF!!!"  onclick="btnPrint()"><span class="fa fa-print"></span></div>
    </div>
    <div style="float: left;margin-left:-364px;margin-top:210px;">
        <label style="margin-left: 50px;margin-right: 5px;margin-top: 0px;margin-bottom: 2px;font-size:14px;">
            Date Issued    :
        </label>
    </div>
    <div style="text-align: right;float: left;margin-left:-187px;margin-top:210px;">
        <input id="datepicker"  title="datepicker" style="width: 140.5px; float: left; margin-left: 0px;" />
        <label style="float:right;margin-top:5px;margin-left:5px;font-size:12px">Apply Date</label>
        <input id="applynewdate" name="applynewdate" type="checkbox" value="0" style="float:right;margin-left:3px;zoom:1.2;margin-top:7px; zoom:1.2" onclick="clkapplynewdate()" />
    </div>
    <div style="float: left;margin-left:-205px;margin-top:250px;">  
        <label style="float:left;margin-top:-5px;margin-left:5px;font-size:12px">View All Transaction(s)</label>
        <input  id="caftrans" name="caftrans" type="checkbox" value="0" style="float:left;margin-left:-142px" onclick="ViewCaftrans()" />
    </div>
 </div>

<div class="transition animated fadeInUp" style="display:inline-block; margin-top:30px;">  
         @(Html.Kendo().Grid<iFMIS_BMS.Models.NonOfficeSubAccount>()
            .Name("cafgrid")
            .Scrollable()
            .Columns(col =>
            {
            col.Template(@<text></text>).Hidden().ClientTemplate("<div>#=caf_id# </div>");
            col.Template(@<text></text>).Hidden().ClientTemplate("<div>#=FMISProgramCode# </div>");
            col.Template(@<text></text>).Hidden().ClientTemplate("<div>#=FMISAccountCode# </div>");
            col.Template(@<text></text>).Hidden().ClientTemplate("<div>#=Ppaid# </div>");
            col.Template(@<text></text>).Hidden().ClientTemplate("<div>#=NOofficeid# </div>");
            col.Template(@<text></text>)
            .HeaderTemplate(@<text>Description</text>)
            .Width(400)
            .HtmlAttributes(new { style = "text-align:left;" })
            .HeaderHtmlAttributes(new { style = "text-align:center;height:30px;", @class = "metro-header" })
             .ClientTemplate("<div>#=Description# </div>")
             .ClientFooterTemplate("<div style='text-align:right;color:darkgreen'><label> TOTAL  : </label></div>");

            col.Bound(c => c.Amount)
            .HeaderTemplate(@<text>Appropriation</text>)
            .Width(135)
            .HtmlAttributes(new { style = "text-align:right;height:30px" })
            .HeaderHtmlAttributes(new { style = "text-align:center;height:30px;", @class = "metro-header" })
            .ClientTemplate("<div>#=kendo.toString(Amount,'c2')# </div>")
            .ClientFooterTemplate("<div style='text-align:right;color:darkgreen'><label> </label><label> #=kendo.toString(sum, 'c2')#</label></div>");
            
            col.Template(@<text></text>)
            .HeaderTemplate(@<text>CAF No.</text>)
            .Width(90)
            .HtmlAttributes(new { style = "text-align:center;" })
            .HeaderHtmlAttributes(new { style = "text-align:center;height:30px;", @class = "metro-header" })
             .ClientTemplate("<div>#=CAFNO# </div>")
             .ClientFooterTemplate("<div style='text-align:right;color:darkgreen'><label> TOTAL  : </label></div>");
            
            col.Template(t => { })
            .HeaderHtmlAttributes(new { style = "text-align:center", @class = "metro-header" })
            .ClientTemplate(
            "<div class='btn-edit'>  <a  title='Edit' onclick='edittrans(#=caf_id#,#=FMISProgramCode#,#=FMISAccountCode#,#=Ppaid#,#=NOofficeid#,\"#=Description#\",#=Amount#)'><span class='fa fa-edit' style ='font-size: 15pt;color:blue'></span></a></div>")
            .HtmlAttributes(new { style = "margin-left:5px;" }).Width(40);

            col.Template(t => { })
            .HeaderHtmlAttributes(new { style = "text-align:center", @class = "metro-header" })
            .ClientTemplate("<div class='btn-delete'> <a  title='Delete' onclick='deletetrans(#=caf_id#)'><span class='fa fa-trash' style='font-size: 15pt;color:red'></span></a></div>")
            .HtmlAttributes(new { style = "margin-left:5px;" }).Width(40);
            })
            .Pageable(pageable => pageable
            .Refresh(true)
            .ButtonCount(4))
            .HtmlAttributes(new { @class = "table-responsive", style = "height:410px;width:750px; overflow-x:hidden;" })
            .Selectable(selectable => selectable
            .Mode(GridSelectionMode.Single)
            .Type(GridSelectionType.Row))
            .DataSource(dataSource => dataSource
            .Ajax()
            .Batch(true)
            .Model(m => m.Id(i => i.caf_id))
            .ServerOperation(false)
            .Aggregates(a =>
            {
                a.Add(c => c.Amount).Sum();
            })
            .PageSize(12)
            .Read(read => read.Action("ViewCAFtransaction", "Release").Data("onData"))
            )
            )
            
</div>
<div style="display:inline-block;width:450px;margin-left:320px">
    <div class="k-button k-button-icontext" style="bottom: 15px; right: 15px;width: 90px;float:left;margin-right:5px; margin-bottom:0px;margin-top:0px;border-radius: 50px;" onclick="btnClear()"><span class="fa fa-eraser"></span> Clear </div>
    <div id="btnSave" class="k-button k-button-icontext" style="bottom: 15px; right: 15px;width: 90px;float:left; margin-right:5px; margin-bottom:0px;margin-top:0px;border-radius: 50px;background-color:cornflowerblue;color:white" onclick="btnSave(0)"><span class="fa fa-save"></span> Save </div>
    <div class="k-button k-button-icontext" style="bottom: 15px; right: 15px;width: 120px;float:left;margin-right:5px; margin-bottom:0px;margin-top:0px;border-radius: 50px;" onclick="btnGenerateCafNo()"><span class="fa fa-money"></span> Generate CAF </div>
    <div class="k-button k-button-icontext" style="bottom: 15px; right: 15px;width: 120px;float:left;margin-right:5px; margin-bottom:0px;margin-top:0px;border-radius: 50px;" onclick="btnpostingcaf()"><span class="fa fa-send"></span> Posting </div>
</div>
<div id="txtfields" display="none">
    <input id="appamount_temp" name="appamount_temp" value="" type="text" min="0" disabled style="width:139px;height:100%;font-size:16px;color:green" class="form-control">
    <input id="totrelamount_temp" name="totrelamount_temp" value="" type="text" min="0" disabled style="width:139px;height:100%;font-size:16px;color:green" class="form-control">
    <input id="balamount_temp" name="balamount_temp" value="" type="text" min="0" disabled style="width:139px;height:100%;font-size:16px;color:green" class="form-control">
    <input id="relamount_temp" name="relamount_temp" value="" type="text" min="0" disabled style="width:139px;height:100%;font-size:16px;color:green" class="form-control">
    <input id="transid" name="transid" value="0" type="number" />
    <input id="subppatag" name="subppatag" value="0" type="number" />
</div>
   
@(Html.Kendo()
.Window()
.Name("addCAFStatement")
.Title("Add Certification Statement")
.Width(495)
.Height(205)
.Visible(false)
.Modal(true)
.Draggable(true)
.AutoFocus(true)
.Animation(a =>
{
    a.Open(o => o.SlideIn(SlideDirection.Down));
    a.Close(c =>
    {
        c.SlideIn(SlideDirection.Down); c.Reverse(true);
    }); 
})
.Actions(a =>
{
    a.Close();
}))
<script>

    $(document).ready(function () {
        $("#txtfields").hide();
        $("#datepicker").kendoDatePicker();
        $("#datepicker").val(new Date().toLocaleDateString());

    });
    function btnpostingcaf() {
        $(window).scrollTop(0);
        var url = "@Url.Action("postcaf", "Release")";

        $.get(url,
               //{
               //    //office: $("#office").val(),
               //    //tyear: tyear,
               //    //fundid: fundid
               //},
           function (d) {
               $('#postcaf').html(d);
           })
        if ($("#epaid").val() == 0) {
            $('#postcaf').data('kendoWindow').title("<i class='fa fa-navicon'> </i> CAF Posting (NON-EPA)").center().open();
        }
        else
        {
            $('#postcaf').data('kendoWindow').title("<i class='fa fa-navicon'> </i> CAF Posting (EPA)").center().open();
        }
    }

    function btnPrint() {
        var cafno = $("#cafhistory").val();
        var year = $("#ddlYear").val();
        var issuedate = $("#datepicker").val();
        var applynewdate = $("#applynewdate").val();
        if ($("#cafhistory").val() != "") {
            //$.ajax({
            //    async: false,
            //    dataType: 'html',
            //    success: window.open("../Reports/ReportViewer.aspx?rid=34&cafno=" + cafno + "&year=" + year + "&issuedate=" + issuedate + "")
            //});
            var url = "@Url.Action("AddCertStatement", "Release")";
            $.get(url, { cafno: cafno, year: year, issuedate: issuedate, applynewdate: applynewdate }, function (d) {
                $('#addCAFStatement').html(d);
            })
                $('#addCAFStatement').data('kendoWindow').title("<i class='fa fa-navicon'> </i> Add Certification Statement").center().open();
        }
        else{
            swal("", "Please select CAF No.!", "warning")
        }
    }
    function ViewCaftrans() {
        if (document.getElementById('caftrans').checked) {

            document.getElementById("caftrans").value = 1;

        } else {

            document.getElementById("caftrans").value = 0;

        }
        $("#cafgrid").data("kendoGrid").dataSource.read();
    }
    function clkapplynewdate() {

        if (document.getElementById('applynewdate').checked) {

            document.getElementById("applynewdate").value = 1;

        } else {

            document.getElementById("applynewdate").value = 0;

        }
    }
    function epa_click() {

        if (document.getElementById('epaid').checked) {

            document.getElementById("epaid").value = 1;

        } else {

            document.getElementById("epaid").value = 0;
        }
        $("#cafhistory").data("kendoComboBox").dataSource.read();
    }
    
    function btnGenerateCafNo() {
        var office = $("#offs").val();
        var program = $("#Progss").val();
        var account = $("#account_list").val();
        var year = $("#ddlYear").val();

        swal({
            title: "C O N F I R M A T I O N !",
            text: "Do you want to generate CAF?",
            type: "warning",
            showCancelButton: true,
            confirmButtonColor: "#DD6B55",
            confirmButtonText: "Yes",
            closeOnConfirm: false
            }, function () {
                url = "@Url.Action("GenerateCafNo","Release")"
                $.get(url, { year: year, office: office, program: program, account: account }, function (d) {
                    if (d == "") {
                        swal("", "There is no CAF generated!", "warning")
                    }
                    else {
                        swal("", "CAF with control number " + d + " has been successfully generated!", "success")
                        $("#cafhistory").data("kendoComboBox").dataSource.read();
                        $("#cafgrid").data("kendoGrid").dataSource.read();
                    }
                })
            });
    }

    function edittrans(caf_id, FMISProgramCode, FMISAccountCode, Ppaid, NOofficeid, Description, Amount) {
        $("#btnSave").attr("onclick", "btnSave(1)");
        $("#btnSave").html("<span class='fa fa-edit'> </span> Update");
        $("#relamount").val(Amount);
        $("#relamount_temp").val(Amount);
        $("#transid").val(caf_id)
    }

    function deletetrans(caf_id) {
        urldelete="@Url.Action("DeleteReleaseCAF","Release")"
        swal({
            title: "Confirmation!",
            text: "Do you want to delete this transaction?",
            type: "warning",
            showCancelButton: true,
            confirmButtonColor: "#DD6B55",
            confirmButtonText: "Yes",
            closeOnConfirm: false
        }, function () {
            $.get(urldelete, { transid: caf_id }, function (d) {
                swal("", "Transaction has been deleted!", "success")
                $("#relamount").val(0)
                fn_computebalance();
            })

        });

    }

    function btnSave(id) {
        var relamount = $("#relamount").val() == "" ? 0 : $("#relamount").val();
        var office = $("#offs").val();
        var program = $("#Progss").val();
        var account = $("#account_list").val();
        var amount = $("#relamount").val();
        var month = 0;
        var year = $("#ddlYear").val();
        var ppaid = $("#subppa_list").val() == "" ? $("#ppa_list").val() : $("#subppa_list").val();
        var charge_office = $("#charge_office").val();
        var transid = $("#transid").val();

        url = "@Url.Action("InsertCAF", "Release")"

        if (Number(relamount) == "0" || Number(relamount) == "0.00")
        {
            swal("", "Please enter release amount!", "warning")
        }
        else if (id == 1) { //Update
            var balamount_temp = $("#balamount_temp").val();
            var relamount_temp = $("#relamount_temp").val();
            var bal2 = (Number(balamount_temp) + Number(relamount_temp)) - Number(relamount);

            if (Number(bal2) < 0)
            {
                swal("", "Release amount must not be greater than the appropriation balance!", "warning")
                $("#relamount").val(relamount_temp);
            }
            else {
                urlupdate="@Url.Action("UpdateReleaseCAF","Release")"
                $.get(urlupdate, { transid: transid, relamount: relamount }, function (d) {
                    swal("", "Transaction has been updated!", "success")
                    $("#relamount").val(0)
                    fn_computebalance();
                    btnClear(1);
                })
            }
        }
        else if (id == 0) { //Insert new trans...
            var balamount_temp = covert_empty($("#balamount").val());
            var relamount_temp = covert_empty($("#relamount").val());
            var bal2 = parseFloat(Number(balamount_temp) - Number(relamount_temp)).toFixed(2);
            if (Number(bal2) < 0) {
                swal("", "Release amount must not be greater than the appropriation balance!", "warning")
                $("#relamount").val("0.00");
            }
            else {
                swal({
                    title: "Confirmation!",
                    text: "Do you want to save this transaction?",
                    type: "warning",
                    showCancelButton: true,
                    confirmButtonColor: "#DD6B55",
                    confirmButtonText: "Yes",
                    closeOnConfirm: false
                }, function () {
                    $.get(url, { office: office, program: program, account: account, amount: amount, month: 0, year: year, ppaid: ppaid, charge_office: charge_office }, function (d) {
                        swal("", "Transaction has been saved!", "success")
                        btnClear(1);

                    })

                });
            }
        }
    }

    function btnClear(id) {
        ocake();
        $("#appamount").val("0.00")
        $("#totrelamount").val("0.00")
        $("#balamount").val("0.00")
        $("#relamount").val("0.00")
        $("#appamount_temp").val("");
        $("#totrelamount_temp").val("");
        $("#balamount_temp").val("");
        $("#charge_office").data("kendoComboBox").value("");
        $("#btnSave").html("<span class='fa fa-save'> </span> Save");
        $("#btnSave").attr("onclick", "btnSave(0)");
        $("#subppatag").val(0)
        $("#cafgrid").data("kendoGrid").dataSource.read();
    }
    function fn_computebalance()
    {
        var year = $("#ddlYear").val()
        var Progid = $("#Progss").val()
        var accountid = $("#account_list").val()
        var ppaid = $("#account_list").val() == 2861 ? $("#subppa_list").val() : 0;
        var chargeofficeid = $("#account_list").val() == 2861 ? 0 : $("#subppa_list").val();
        var url = "@Url.Action("CAFComputation", "Release")"

        $.get(url, { year: year, Progid: Progid, accountid: accountid, ppaid: ppaid, chargeofficeid: chargeofficeid }, function (d) {
            $("#appamount").val(MoneyFormat(d.Appropriation));
            $("#totrelamount").val(MoneyFormat(d.AllotedAmount));
            $("#balamount").val(MoneyFormat(d.BalanceAllotment));
            $("#appamount_temp").val(d.Appropriation);
            $("#totrelamount_temp").val(d.AllotedAmount);
            $("#balamount_temp").val(d.BalanceAllotment);

            $("#cafgrid").data("kendoGrid").dataSource.read();
        });

    }
    function Select_Office() {
        var classtype = $("#classtype").val();

        if (classtype == null || classtype == "") {

            return { classtype: 2 }
        }
        else {
            return { classtype: classtype }
        }
    }

    function Select_exp() {
        return {
            officeaccounts: 1,
            year:0
        }
    }
    function fn_Offices() {
        var proyy = $("#ddlYear").val();
        var off_id = $("#offs").val();

        return {
            propYear: proyy,
            office_ID: off_id
        }
    }
    function fn_dprefresher() {
        $("#Progss").data("kendoDropDownList").dataSource.read();
        //$("#account_list").data("kendoComboBox").dataSource.read();
        //$("#account_list").data("kendoComboBox").value("");

    }
    function fn_dprefresherprogs() {
        $("#account_list").data("kendoComboBox").dataSource.read();
        $("#account_list").data("kendoComboBox").value("");
    }
    function ocake() {
        var year = $("#ddlYear").val()
        var Progid = $("#Progss").val()
        var accountid = $("#account_list").val()

        //$("#ppa_list").data("kendoComboBox").dataSource.read();
        //$("#ppa_list").data("kendoComboBox").value("");

        //$("#subppa_list").data("kendoComboBox").dataSource.read();
        //$("#subppa_list").data("kendoComboBox").value("");
        var url = "@Url.Action("checksubppa", "Release")"
        $.get(url, { year: year, Progid: Progid, accountid: accountid }, function (d) {
            $("#subppatag").val(d)

            $("#ppa_list").data("kendoComboBox").dataSource.read();
            $("#ppa_list").data("kendoComboBox").value("");
            $("#subppa_list").data("kendoComboBox").value("");

            fn_computebalance()
            $("#cafgrid").data("kendoGrid").dataSource.read();

            $("#cafhistory").data("kendoComboBox").dataSource.read();
        });
        //    fn_computebalance()
        //    $("#cafgrid").data("kendoGrid").dataSource.read();

        //$("#cafhistory").data("kendoComboBox").dataSource.read();
    }
    function fn_ForPPA() {
        var ppayear = 0;
        var year = $("#ddlYear").val()
        var Progid = $("#Progss").val()
        var accountid = $("#account_list").val()

        @*var url = "@Url.Action("checksubppa", "Release")"
        $.get(url, { year: year, Progid: Progid, accountid: accountid }, function (d) {
            $("#subppatag").val(d) *@

            if ($("#account_list").val() == 2861 || $("#subppatag").val() > 0) {
                ppayear = $("#ddlYear").val();
                document.getElementById("ppalabel").style.display = "inline"
                document.getElementById("ppalist").style.display = "inline"
                document.getElementById("subppalabel").style.display = "inline"
                document.getElementById("subppalist").style.display = "inline"
                document.getElementById("chargeoffice").style.display = "none"
                document.getElementById("chargeofficelabel").style.display = "none"
            }
            else if ($("#account_list").val() == 336 || $("#account_list").val() == 334 || $("#account_list").val() == 342) {
                document.getElementById("ppalabel").style.display = "none"
                document.getElementById("ppalist").style.display = "none"
                document.getElementById("subppalabel").style.display = "none"
                document.getElementById("subppalist").style.display = "none"
                document.getElementById("chargeoffice").style.display = "inline"
                document.getElementById("chargeofficelabel").style.display = "inline"
            }
            else {
                document.getElementById("ppalabel").style.display = "none"
                document.getElementById("ppalist").style.display = "none"
                document.getElementById("subppalabel").style.display = "none"
                document.getElementById("subppalist").style.display = "none"
                document.getElementById("chargeoffice").style.display = "none"
                document.getElementById("chargeofficelabel").style.display = "none"

                ppayear = 9999;
            }

            return {
                ppayear: ppayear,
                subppatag: $("#subppatag").val(),
                Progid: Progid,
                accountid:accountid
            }
        //});

    }
    function onClickSubppa() {
        if ($("#ppa_list").val() != 0) {
            $("#subppa_list").data("kendoComboBox").dataSource.read();
            $("#subppa_list").data("kendoComboBox").value("");
        }
    }
    function fn_ForSubPPA() {
        var ppayear = 0;
        var year = $("#ddlYear").val()
        var Progid = $("#Progss").val()
        var accountid = $("#account_list").val()
        var ppa_list = $("#ppa_list").val();

        if ($("#account_list").val() == 2861 || $("#subppatag").val() > 0) {
            ppayear = $("#ddlYear").val();
        }
        else {
            ppayear = 9999;
        }

        return {
            ppayear:ppayear,
            ppa_list: ppa_list,
            Progid: Progid,
            accountid:accountid,
            subppatag: $("#subppatag").val()
        }

    }
</script>

@(Html.Kendo().Window()
        .Name("postcaf")
        //.Title("")
        .Width(1010)
        .Height(555)
        .Visible(false)
        .Modal(true)
        .Draggable(true)
        .AutoFocus(true)
        //  .Events(e => e.Close("closewfpapproved_lce"))
        .Animation(a =>
        {
            a.Open(o => o.SlideIn(SlideDirection.Down));
            a.Close(c =>
            {
                c.SlideIn(SlideDirection.Down);
                c.Reverse(true);
            });
        })
                .Actions(a => { a.Close(); })
)