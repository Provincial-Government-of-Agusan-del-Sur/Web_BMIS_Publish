<script src="~/Scripts/BMS/Release/otherfunction.js"></script>
<script src="~/Scripts/BMS/global-functions.js"></script>
<script>
    function ConvertCommasToEmpty_realignapprove(str) {
        str = str.toString().replace(/,/g, "");
        parseInt(str, 20);
        return str;
    }
    function RealGridApprove() {
        var office_id = $('#office_realigned_to_null').val()
        var program_id = $('#Program_realigned_to_null').val() == "" ? 0 : $('#Program_realigned_to_null').val()
        var account_id = $('#account_list_realigned_to_null').val() == "" ? 0 : $('#account_list_realigned_to_null').val()
        var subaccount = 0
        return {
            office_id: office_id,
            program_id: program_id,
            account_id: account_id,
            yearof: $("#ddlYear").val(),
            subaccount: subaccount,
            submit:1,
            approved:1,
            posted: $("#postedid").val() == 1? 1:0,
            ooe_id_from:0
        }
    }
    function searchApproved() {
        var $filter = new Array();
        $filter = [];

        if ($('#SearchRealignApprove').val().length > 0) {
            $filter.push({ field: "accountfrom", operator: "contains", value: $('#SearchRealignApprove').val() }),
            $filter.push({ field: "ppafrom", operator: "contains", value: $('#SearchRealignApprove').val() }),
            $filter.push({ field: "accountto", operator: "contains", value: $('#SearchRealignApprove').val() }),
            $filter.push({ field: "ppato", operator: "contains", value: $('#SearchRealignApprove').val() });
        }

        $('#grd_realignapproved').data('kendoGrid').dataSource.filter({
            logic: "or",
            filters: $filter
        });

    }

    $(function () {
        $("#SearchRealignApprove").keypress(function (e) {
            if (e.keyCode == 13) {
                searchApproved();
            }
        });
    });
    function frmRealignApproveClose() {
        $("#realignmentapproved").data("kendoWindow").close();
    }
    function btnPostRealign() {
        if ($('#SpanOnApproveProgress').css("display") == 'none') {
            $('#SpanOnApproveProgress').css("display", "auto");
            $('#spanthumbsup').css("display", "none");
            var url = "@Url.Action("PostRealignment", "Release")";
            var idsToSend = [];
            var AmountsToSend = [];
            var BudgetToSend = [];
            var grid = $("#grd_realignapproved").data("kendoGrid")
            var ds = grid.dataSource.view();

            if (@Account.UserInfo.UserTypeID == 4 ) {
                for (var i = 0; i < ds.length; i++) {
                    var row = grid.table.find("tr[data-uid='" + ds[i].uid + "']");
                    var checkbox = $(row).find(".checkbox");
                    //if (checkbox.is(":checked")) {
                    idsToSend.push(ds[i].realignmentid); //loops
                    //}
                }
                //if (idsToSend == "") {
                //    swal({ title: "Error!", text: "Please tick the checkbox first!", timer: 2500, showConfirmButton: false, type: "error" });
                //    $('#SpanOnApproveProgress').css("display", "none");
                //    $('#spanthumbsup').css("display", "auto");
                //} else {
                    swal({
                        title: "Confirmation!",
                        text: "All transactions on the list below will be posted as realigned appropriation. Do you want to proceed?",
                        type: "info",
                        showCancelButton: true,
                        closeOnConfirm: false,
                        confirmButtonColor: "#1fa67a",
                        confirmButtonText: "Yes",
                        showLoaderOnConfirm: true,
                    }, function (isConfirm) {
                        if (isConfirm) {
                            $.post(url, { realtrans: idsToSend }, function (d) {
                                if (d == "1") {
                                    swal({ title: "Success!", text: "Realignment has been posted!", timer: 1000, showConfirmButton: false, type: "success" });
                                    $("#grd_realignapproved").data("kendoGrid").dataSource.read();
                                    $('#SpanOnApproveProgress').css("display", "none");
                                    $('#spanthumbsup').css("display", "auto");
                                }
                                else {
                                    swal("Error!", d, "error");
                                    $('#SpanOnApproveProgress').css("display", "none");
                                    $('#spanthumbsup').css("display", "auto");
                                }
                            });
                        }
                        else {
                            $('#SpanOnApproveProgress').css("display", "none");
                            $('#spanthumbsup').css("display", "auto");
                        }
                    }
                    )
                //}
            }
        }
    }
    function onDataBound(e) {
        $(".k-hierarchy-cell").hide();
        $(".k-hierarchy-col").hide();
        var grid = $("#grd_realignapproved").data("kendoGrid")
        var ds = grid.dataSource.view();
        var rows = e.sender.tbody.children();

        if (@Account.UserInfo.UserTypeID != 4 ) {
            $('#postrealignmentid').css("display", "none");
        }

        for (var i = 0; i < ds.length; i++) {
            trnno = ds[i].realignmentid
            var row = $(rows[i]);
            if (@Account.UserInfo.UserTypeID == 4 ) {
                $('#realignid' + trnno + '').css("display", "normal");
            }
            else{
                $('#realignid' + trnno + '').css("display", "none");
            }
        }
    }
    function postedid() {
        if (document.getElementById('postedid').checked) {
            document.getElementById("postedid").value = 1;
        } else {
            document.getElementById("postedid").value = 0;
        }
        $("#grd_realignapproved").data("kendoGrid").dataSource.read();
    }
    function CheckAll(e) {
        $("#grd_realignapproved tbody input:checkbox").prop("checked", e.checked);
    }
    function fnReportHistory() {
        return {
            officeid: $("#office_realigned_to_null").val(),
            monthof: 0
        }
    }
    function realgridApproveEdit() {

        var entityGrid = $("#grd_realignapproved").data("kendoGrid");
        var selectedItem = entityGrid.dataItem(entityGrid.select());
      //  var revbal=covert_empty($("#toberevert_null").val())
        var revsummaryid=$("#revsummaryid").val()
        var officeid = selectedItem.tooffice == 0 ? selectedItem.fromoffice : selectedItem.tooffice
        var year_ = $("#ddlYear").val();
        var program_id = selectedItem.toprogram == 0 ? selectedItem.fromprogram : selectedItem.toprogram
        var account_id = selectedItem.toaccount == 0 ? selectedItem.fromaccount : selectedItem.toaccount
        var subppaid = selectedItem.subaccount

        //$("#accountid_toOrig").val(selectedItem.toaccount)
        //if (selectedItem.AmountApprove == 0){
            $("#amounttorealign_approveupdate").val(selectedItem.Amount)
            $("#t_amountorig").val(selectedItem.Amount)
        //}
        //else{
        //    $("#amounttorealign_approveupdate").val(selectedItem.AmountApprove)
        //    $("#t_amountorig").val(selectedItem.AmountApprove)
        //}
        $("#accountid_to").val(selectedItem.toaccount)
        $("#realigid").val(selectedItem.realignmentid)

        var lru = "@Url.Action("thatassET", "Release")";
        var url = "@Url.Action("datassV2", "Release")";

        $.post(lru, { year_: year_, officeid: officeid }, function (e) { // total amount to realign
            document.getElementById("t_realignamountotal").value = e;
        })
        $.post(url, { office_id: officeid, program_id: program_id, account_id: account_id, year_: year_, subppaid: subppaid }, function (e) { // total available amount
            document.getElementById("t_amountavailable").value = e;
        })
    }
</script>
<div style="display:inline-block;margin-bottom:-5px;">
    <input type="checkbox" id="postedid" onclick="postedid()" value="0" style="float:left;zoom:1.5"/>
    <label style="display:inline-block; font-size:14px;font-weight:normal"> &nbsp;View Posted Realignment</label>
</div>
<div id="searchAccountid" style="height: 30px; margin-top: -5px; float: right;">
    <input type="text" style="width:271.5px;border-collapse:collapse;margin:0px;border-style:solid;margin-left:0px;height:70%;outline:none;font-family:'Segoe UI Light_','Open Sans Light',Verdana,Arial,Helvetica,sans-serif;float:left;" placeholder="Search..." id="SearchRealignApprove" name="SearchRealignApprove">
    <div class="k-button k-button-icontext" style="height:30px;width:40px;border-style:solid;" onclick="searchApproved()"><span class="mif-search"></span></div>
</div>
<br />
<div style="margin-top:6px;">
    @(Html.Kendo().Grid<iFMIS_BMS.BusinessLayer.Models.Monthly_DD_Model>()
    .Name("grd_realignapproved")
    // .Scrollable()
    .Columns(col =>
    {

        @*col.Template(@<text></text>)
            .ClientTemplate("<input id='check#=realignmentid#' type='checkbox'  class='checkbox'/>")
            .Title("<input onclick=CheckAll(this) type='checkbox'  class='checkbox'/> <span style='text - align:center; vertical - align:middle; height: 30px;font-weight:600;font-size:14px;'>Approve</span> ")
            .Width(100)
            .HtmlAttributes(new { style = "text-align:center;height:30px;font-size:12px;" })
            .HeaderHtmlAttributes(new { style = "text-align:center; vertical-align: middle; overflow: visible; white-space: normal" });*@
        col.Template(@<text></text>).HtmlAttributes(new { style = "text-align:left;height:30px" })
                        .HeaderTemplate(@<text><div style="font-weight:600;text-align:center; vertical-align: middle; overflow: visible; white-space: normal;">Account <br />(From)</div></text>)
                        .Width(150)
                        .ClientTemplate("<div>#=accountfrom# </div>")
                        .HeaderHtmlAttributes(new { style = "text-align:center; vertical-align: middle; overflow: visible; white-space: normal" });
        col.Template(@<text></text>).HtmlAttributes(new { style = "text-align:left;height:30px" })
                        .HeaderTemplate(@<text><div style="font-weight:600;text-align:center; vertical-align: middle; overflow: visible; white-space: normal;">PPA <br />(From)</div></text>)
                        .Width(150)
                        .ClientTemplate("<div>#=ppafrom# </div>")
                        .HeaderHtmlAttributes(new { style = "text-align:center; vertical-align: middle; overflow: visible; white-space: normal" });
    //    .ClientFooterTemplate("<div style='text-align:right;'><label> </label><label> Total</label></div>");
    col.Template(@<text></text>).HtmlAttributes(new { style = "text-align:left;height:30px" })
                        .HeaderTemplate(@<text><div style="font-weight:600;text-align:center; vertical-align: middle; overflow: visible; white-space: normal;">Account <br />(To)</div></text>)
                        .Width(150)
                        .ClientTemplate("<div>#=accountto# </div>")
                        .HeaderHtmlAttributes(new { style = "text-align:center; vertical-align: middle; overflow: visible; white-space: normal" });
        col.Template(@<text></text>).HtmlAttributes(new { style = "text-align:left;height:30px" })
                        .HeaderTemplate(@<text><div style="font-weight:600;text-align:center; vertical-align: middle; overflow: visible; white-space: normal;">PPA <br />(To)</div></text>)
                        .Width(150)
                        .ClientTemplate("<div>#=ppato# </div>")
                        .HeaderHtmlAttributes(new { style = "text-align:center; vertical-align: middle; overflow: visible; white-space: normal" });
        col.Bound(m => m.Amount)
                        .HtmlAttributes(new { style = "text-align:right;height:30px" })
                        .HeaderTemplate(@<text><div style="font-weight:600;text-align:center; vertical-align: middle; overflow: visible; white-space: normal;">Amount</div></text>)
                    .Width(100)
                    .HeaderHtmlAttributes(new { style = "text-align:center; vertical-align: middle; overflow: visible; white-space: normal" })
                    .ClientTemplate("<div>#=kendo.toString(Amount,'c2')# </div>");
        col.Bound(m => m.datetimeapprove)
                        .HtmlAttributes(new { style = "text-align:right;height:30px" })
                        .HeaderTemplate(@<text><div style="font-weight:600;text-align:center; vertical-align: middle; overflow: visible; white-space: normal;">Date and Time <br />Approved</div></text>)
                .Width(180)
                .HeaderHtmlAttributes(new { style = "text-align:center; vertical-align: middle; overflow: visible; white-space: normal" })
                .ClientTemplate("<div>#=datetimeapprove# </div>");
        col.Bound(m => m.mode)
                .HtmlAttributes(new { style = "text-align:center;height:30px;font-size:12px;" })
                .HeaderTemplate(@<text><div style="font-weight:600;text-align:center;font-size:14px; vertical-align: middle; overflow: visible; white-space: normal;">Status</div></text>)
            .Width(80)
            .HeaderHtmlAttributes(new { style = "text-align:center; vertical-align: middle; overflow: visible; white-space: normal" })
            .ClientTemplate("<div>#=mode# </div>");
    //  .ClientFooterTemplate("<div style='text-align:right;color:darkgreen'><label> </label><label> #=kendo.toString(sum, 'c2')#</label></div>");

        //col.Template(t => { }).ClientTemplate(
        //            "<div class='k-button k-button-icontext' style='border-radius:50px;color:\\#ffffff;background-color:\\cornflowerblue;' onclick='sup_Edits(#=realignmentid#,#=fromprogram#,#=fromaccount#,#=toprogram#,#=toaccount#,#=subaccount#,#=Amount#,#=tooffice#,#=fromoffice#)'><span class='fa fa-pencil-square-o' style='font-size:10pt;margin:1px;margin-top:-1px;margin-left:1px;margin-right:1px;'> </span>edit</div> " +
        //            "<div class='k-button k-button-icontext' style='border-radius:50px;color:\\#ffffff;background-color:\\#DE5555;'   onclick='sup_Deletes(#=realignmentid#,#=toaccount#,#=Amount#,#=tooffice#,#=toprogram#,#=subaccount#)'   ><span class='fa fa-trash-o' style='font-size: 10pt;margin: 1px;margin-top:-1px;margin-left:1px;margin-right:1px;'> </span>del</div> "
        //            ).HtmlAttributes(new { style = "vertical-align: top;" }).Width(158);
        col.Template(t => { }).ClientTemplate(
                        "<div id='realignid#=realignmentid#' class='k-button k-button-icontext' style='display:none;border-radius:50px;color:\\#ffffff;background-color:\\#DE5555;'onclick='realign_disapprove(#=realignmentid#,#=fromaccount#)'><span class='fa fa-thumbs-down' style='font-size: 10pt;margin: 1px;margin-top:-1px;margin-left:1px;margin-right:1px;'></span>Disapprove</div> "
                        ).HtmlAttributes(new { style = "vertical-align: middle;" }).Width(125);
        col.Bound(m => m.realignmentid).HtmlAttributes(new { style = "text-align:left;height:30px" })
                    .HeaderTemplate(@<text><div style="font-weight:600;text-align:center; vertical-align: middle; overflow: visible; white-space: normal;">id</div></text>)
                        .Hidden()
                        .HeaderHtmlAttributes(new { style = "text-align:center; vertical-align: middle; overflow: visible; white-space: normal" });
        col.Bound(m => m.fromprogram).HtmlAttributes(new { style = "text-align:left;height:30px" })
                        .HeaderTemplate(@<text><div style="font-weight:600;text-align:center; vertical-align: middle; overflow: visible; white-space: normal;">program(from)</div></text>)
                        .Hidden()
                        .HeaderHtmlAttributes(new { style = "text-align:center; vertical-align: middle; overflow: visible; white-space: normal" });
        col.Bound(m => m.fromaccount).HtmlAttributes(new { style = "text-align:left;height:30px" })
                        .HeaderTemplate(@<text><div style="font-weight:600;text-align:center; vertical-align: middle; overflow: visible; white-space: normal;">account(from)</div></text>)
                        .Hidden()
                        .HeaderHtmlAttributes(new { style = "text-align:center; vertical-align: middle; overflow: visible; white-space: normal" });
        col.Bound(m => m.toprogram).HtmlAttributes(new { style = "text-align:left;height:30px" })
                        .HeaderTemplate(@<text><div style="font-weight:600;text-align:center; vertical-align: middle; overflow: visible; white-space: normal;">program(to)</div></text>)
                        .Hidden()
                        .HeaderHtmlAttributes(new { style = "text-align:center; vertical-align: middle; overflow: visible; white-space: normal" });
        col.Bound(m => m.toaccount).HtmlAttributes(new { style = "text-align:left;height:30px" })
                        .HeaderTemplate(@<text><div style="font-weight:600;text-align:center; vertical-align: middle; overflow: visible; white-space: normal;">account(to)</div></text>)
                        .Hidden()
                        .HeaderHtmlAttributes(new { style = "text-align:center; vertical-align: middle; overflow: visible; white-space: normal" });
        col.Bound(m => m.subaccount).HtmlAttributes(new { style = "text-align:left;height:30px" })
                        .HeaderTemplate(@<text><div style="font-weight:600;text-align:center; vertical-align: middle; overflow: visible; white-space: normal;">sub-account</div></text>)
                        .Hidden()
                        .HeaderHtmlAttributes(new { style = "text-align:center; vertical-align: middle; overflow: visible; white-space: normal" });
        col.Bound(m => m.tooffice).HtmlAttributes(new { style = "text-align:left;height:30px" })
                        .HeaderTemplate(@<text><div style="font-weight:600;text-align:center; vertical-align: middle; overflow: visible; white-space: normal;">office(to)</div></text>)
                        .Hidden()
                        .HeaderHtmlAttributes(new { style = "text-align:center; vertical-align: middle; overflow: visible; white-space: normal" });
        col.Bound(m => m.fromoffice).HtmlAttributes(new { style = "text-align:left;height:30px" })
                        .HeaderTemplate(@<text><div style="font-weight:600;text-align:center; vertical-align: middle; overflow: visible; white-space: normal;">office(from)</div></text>)
                        .Hidden()
                        .HeaderHtmlAttributes(new { style = "text-align:center; vertical-align: middle; overflow: visible; white-space: normal" });
    })
    .ToolBar(toolbar =>
    {
        toolbar.Custom().Text("<div id='postrealignmentid'> <span id='spanthumbsup' class='fa fa-save'> </span><span id='SpanOnApproveProgress' style='display:none' class='fa fa-spinner fa-spin'></span> Post Realignment</div>").Name("btnApprove").Url("javascript:void(0)").HtmlAttributes(new { onclick = "btnPostRealign()" });
        // toolbar.Save();
    })
    .Sortable()
    .Scrollable()
    .Selectable()
    //    .Events(e => e.Change("WFPgrid"))
    .HtmlAttributes(new { style = "height:450px;" })
    .Pageable(pageable => pageable
        .Refresh(true)
        .ButtonCount(2))
    .Events(e => e.DataBound("onDataBound").Change("realgridApproveEdit"))
    .DataSource(d => d
    .Ajax()
    //.Aggregates(a =>
    //{
    //    a.Add(c => c.Amount).Sum();
    //})
    .PageSize(1000)
    .Model(m => m.Id(i => i.supplementalbudget_id))
    .Read(read => read.Action("Load_Realign_Req", "Release").Data("RealGridApprove")))
    )

</div>
<div id="lblapprealignid" style="float:left;margin-left:108.5px;margin-top:20px;display:none">
    <label style="margin-left:50px;margin-right:5px;margin-top:0px;margin-bottom:2px;font-size:14px">
        Amount to Realign :
    </label>
</div>
<div id="apprealignamountid" style="float: right;margin-right:478.5px;margin-top:15px;display:none">
    <input type="text" style="width:180px; color: red" name="amounttorealign_approveupdate" id="amounttorealign_approveupdate" onkeyup="commaSeparateNumberOnly('amounttorealign_approveupdate')">
</div>
<div style="float: right;margin-right:646.5px;margin-top:20px;width:170px;">
    <label style="float:left;margin-left: 50px;font-size:14px">
        MAF History   :
    </label>
</div>

<div style="float:left;margin-left:295px;width:350px;margin-top:-30px;">
    @(Html.Kendo().ComboBox()
                        .Name("realignHistory")
                        .DataTextField("datetime")
                        .DataValueField("mafid")
                        .SelectedIndex(-1)
                        .Filter("contains")
                        .MinLength(3)
                        .HtmlAttributes(new { style = "width:100%; height:100%", @class = "form-control autoselect" })
                        .DataSource(source => source.Read(read => read.Action("GetReportSupplementalHistory", "Report").Data("fnReportHistory")))
    )
</div>
<div class="k-button k-button-icontext" id="realapprovedupdateid" style="float:left; bottom: 15px; right: 25px;width: 100px;background-color:cornflowerblue; color:white;border-radius:50px;margin-left:585px;margin-top:25px;" onclick="frmRealignApproveUpdate()"><span class="fa fa-edit"></span> Update</div>
<div class="k-button k-button-icontext" id="realpreviewid" style="float:left; bottom: 15px; right: 25px;width: 100px;background-color:cornflowerblue; color:white;border-radius:50px;margin-left:700px;margin-top:-30px;" onclick="frmPreviewSubmitted()"><span class="fa fa-print"></span> Preview</div>
<div class="k-button k-button-icontext" id="realcloseid" style="float:right; bottom: 15px; right: 25px;width: 100px;background-color:indianred; color:white;border-radius:50px;margin-right:50px;margin-top:-30px;" onclick="frmRealignApproveClose()"><span class="fa fa-close"></span> Close</div>
<div style="display:none">
    <input type="number" id="t_amountorig" value="0"/>
    <input type="number" id="t_realignamountotal" value="0" />
    <input type="number" id="t_amountavailable" value="0" />
    <input type="number" id="t_amountavailable_to" value="0" />
    <input type="number" id="accountid_to" value="0" />
    <input type="number" id="realigid" value="0" />
</div>
<script>
    $(document).ready(function(){
        if (@Account.UserInfo.UserTypeID !=4){
            document.getElementById("lblapprealignid").style="display:none"
            document.getElementById("apprealignamountid").style="display:none"
            document.getElementById("realapprovedupdateid").style="display:none"
            $("#realignmentapproved").data("kendoWindow").setOptions({height:600})
            document.getElementById("realpreviewid").style="float:left; bottom: 15px; right: 25px;width: 100px;background-color:cornflowerblue; color:white;border-radius:50px;margin-left:700px;margin-top:30px;"
            document.getElementById("realcloseid").style="float:right; bottom: 15px; right: 25px;width: 100px;background-color:indianred; color:white;border-radius:50px;margin-right:50px;margin-top:30px;"
        }
        else{
            document.getElementById("lblapprealignid").style="float:left;margin-left:108.5px;margin-top:20px;display:normal"
            document.getElementById("apprealignamountid").style="float: right;margin-right:478.5px;margin-top:15px;display:normal"
            $("#realignmentapproved").data("kendoWindow").setOptions({height:642})
        }
    })

    function realign_disapprove(realignmentid, fromaccount) {
        var year = $("#ddlYear").val();

        var url="@Url.Action("realigndisapprove", "Release")";
        //getbalances()

        swal({
            title: "Warning?",
            text: "Disapprove this transaction?",
            type: "info",
            showCancelButton: true,
            closeOnConfirm: false,
            confirmButtonColor: "#1fa67a",
            confirmButtonText: "Yes",
            showLoaderOnConfirm: true,
        }, function () {
            $.post(url, {
                realignmentid: realignmentid, accountto: fromaccount
            }, function (e) {

                if (e == "success") {
                    swal({
                        title: "Success!",
                        text: "Transaction has been disapproved!",
                        timer: 2000,
                        type: "success",
                        showConfirmButton: false
                    })
                    $('#grd_realignapproved').data('kendoGrid').dataSource.read();
                } else {
                    swal({
                        title: "Error!",
                        text: e,
                        timer: 2000,
                        type: "error",
                        showConfirmButton: false
                    })
                }
            });
        })
    }

    function frmPreviewSubmitted() {
        var program_id = $('#Program_realigned_to_null').val() == "" ? 0 : $('#Program_realigned_to_null').val()
        var accountid = $('#account_list_realigned_to_null').val() == "" ? 0 : $('#account_list_realigned_to_null').val()
        var yearof = $("#ddlYear").val()
        var office = $('#office_realigned_to_null').data("kendoComboBox").text()
        var officeid = $('#office_realigned_to_null').val()
        var repHistory = $('#realignHistory').val()
        $.ajax({
            async: false,
            dataType: 'html',
            success: window.open("../Reports/ReportViewer.aspx?rid=39&programID=" + program_id + "&accountID=" + accountid + "&yearof=" + yearof + "&OfficeName=" + office + "&OfficeID=" + officeid + "&mode=2&approverepHistory=" + repHistory + "&source=1")
        });
    }
    function frmRealignApproveUpdate() {
        var availableamount = covert_empty($("#t_amountavailable").val())
        var realignamount_from = $("#t_amountorig").val()
        var realignamount = covert_empty($("#amounttorealign_approveupdate").val())
        var toberealign_null = covert_empty($("#t_realignamountotal").val())
  
        var realigid = $("#realigid").val()
        var accountid_to = $("#accountid_to").val()

        var bal = parseFloat((Number(availableamount) + Number(realignamount_from)) - Number(realignamount)).toFixed(2)
        var bal2 = parseFloat(Number(toberealign_null) + (Number(realignamount_from) - Number(realignamount))).toFixed(2)

        var amount = covert_empty($("#amounttorealign_approveupdate").val())
        //}
        var url = "@Url.Action("realigforapprovalupdate", "Release")";
        if (bal < 0) {
            swal("Warning", "Please be reminded, the amount to realign must not be greater than the available amount!", "warning")
            $("#amounttorealign_approveupdate").val(commaSeparateNumberRealignment(realignamount_from))
        }else if (bal2 < 0) {
            swal("Warning", "Insufficient amount! Realign amount might be already used for realignment.", "warning")
            $("#amounttorealign_approveupdate").val(commaSeparateNumberRealignment(realignamount_from))
        }
        else {
            $.post(url, { realigid: realigid, accountid_to: accountid_to, amount: amount}, function (e) {
                if (e == "success") {
                    swal("Success","Realignment of appropriation is successfully updated!","success")
                    $("#grd_realignapproved").data("kendoGrid").dataSource.read();
                }
                else {
                    swal("Error",e,"error")
                }
            })
        }
    }
</script>