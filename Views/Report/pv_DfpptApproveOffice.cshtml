
<script>
    function CheckAll(e) {
        $("#grd_dffptapproveoffice tbody input:checkbox").prop("checked", e.checked);
    }
    function getParam() {
        return {
            office:'@Session["office"]',
            tyear: '@Session["tyear"]',
            id:1,
            ooeid:'@Session["ooeid"]',
            qtr:'@Session["qtr"]'
        }
    }
  

    function frmclose() {
        $("#dffptapprovedOffice").data("kendoWindow").close();
    }
    function onDataBound(e) {
        $(".k-hierarchy-cell").hide();
        $(".k-hierarchy-col").hide();
        var grid = $("#grd_dffptapproveoffice").data("kendoGrid")
        var ds = grid.dataSource.view();
        var rows = e.sender.tbody.children();

        for (var i = 0; i < ds.length; i++) {
            trnno = ds[i].trnno;
            firstmon_release=ds[i].firstmonth_rel
            secondmon_release=ds[i].secondmonth_rel
            thirdmon_release=ds[i].thirdmonth_rel

            var row = $(rows[i]);
            if (@Session["id"] == 1 && (firstmon_release == 0 || secondmon_release == 0 || thirdmon_release == 0)) {
                $('#deleteid' + trnno + '').css("display", "normal");
            }
            else {
                $('#deleteid' + trnno + '').css("display", "none");
                grid.hideColumn('deleteid' + trnno + '');
            }
        }
    }
    function searchSubmitConsol() {
        var $filter = new Array();
        $filter = [];

        if ($('#searchSubmitConsol').val().length > 0) {
            $filter.push({ field: "AccountName", operator: "contains", value: $('#searchSubmitConsol').val() }),
            $filter.push({ field: "ooe", operator: "contains", value: $('#searchSubmitConsol').val() }),
            $filter.push({ field: "Qtr", operator: "contains", value: $('#searchSubmitConsol').val() })
        }

        $('#grd_dffptapproveoffice').data('kendoGrid').dataSource.filter({
            logic: "or",
            filters: $filter
        });

    }

    $(function () {
        $("#searchSubmitConsol").keypress(function (e) {
            if (e.keyCode == 13) {
                searchSubmitConsol();
            }
        });
    });
    function reqPrintApproved() {
       // alert(12)
       
            var url = "@Url.Action("WFPreportemp", "Report")";
            var idsToSend = [];
            var AmountsToSend = [];
            var BudgetToSend = [];
            var grid = $("#grd_dffptapproveoffice").data("kendoGrid")
            var ds = grid.dataSource.view();

            for (var i = 0; i < ds.length; i++) {
                var row = grid.table.find("tr[data-uid='" + ds[i].uid + "']");
                var checkbox = $(row).find(".checkbox");
                if (checkbox.is(":checked")) {
                    idsToSend.push(ds[i].trnno); //loops
                }
            }

            if (idsToSend == "") {
                swal({ title: "Error!", text: "Please mark as check at least one account!", timer: 2500, showConfirmButton: false, type: "error" });
                $('#SpanOnApproveProgress').css("display", "none");
                $('#spanthumbsup').css("display", "auto");    
            } else {
                var officeid = $("#office").val();
                var ooeid = $("#ooe_id").val();
                var yearof = $("#ProposalYear").val();
                var qtr = $("#quarter").val();
                var mpoffice = $("#office").data("kendoComboBox").text();
                var empname=$("#empid").data("kendoComboBox").text();
                var empid=$("#empid").val();
                var repHistory=$("#repHistory").val();
                var prepdfppt=$("#prepdfppt").val();
                var approvedfppt=$("#approvedfppt").val();

                $.post(url, { transno: idsToSend}, function (d) {
                    if (d == 1) {
                        $.ajax({
                            async: false,
                            dataType: 'html',
                            success: window.open("../Reports/ReportViewer.aspx?rid=31&officeid=" + officeid + "&ooeid=" + ooeid + "&yearof=" + yearof + "&qtr=" + qtr + "&mpoffice=" + mpoffice + "&empname="+ empname +"&empid="+ empid +"&repHistory="+ repHistory +"&prepdfppt=1&approvedfppt=1&accountidlist=1")
                        });
                    }
                })
            }
    }
</script>
<div id="searchAccountid" style="height: 30px; margin-top: 0px; float: right; margin-left: 200px;">
    <input type="text" style="width:406px;border-collapse:collapse;margin:0px;border-style:solid;margin-left:0px;height:70%;outline:none;font-family:'Segoe UI Light_','Open Sans Light',Verdana,Arial,Helvetica,sans-serif;float:left;" placeholder="Search..." id="searchSubmitConsol" name="searchSubmitConsol">
    <div class="k-button k-button-icontext" style="height:30px;width:40px;border-style:solid;" onclick="searchSubmitConsol()"><span class="mif-search"></span></div>
</div>
<div class="fa fa-re">
    @(Html.Kendo().Grid<iFMIS_BMS.BusinessLayer.Models.WFPSubmitted>()
        .Name("grd_dffptapproveoffice")
        .HtmlAttributes(new { style = "height:450px;" })
        .Scrollable()
        .Columns(col =>
        {
        col.Template(@<text></text>)
            .ClientTemplate("<input id='check#=accountid#' type='checkbox'  class='checkbox'/>")
            .Title("<input onclick=CheckAll(this) type='checkbox'  class='checkbox'/> <span style='text - align:center; vertical - align:middle; height: 30px; background - color:#ff6a00;font-size:14px;color:beige;font-weight:100;'>Preview</span> ")
            .Width(85)
            //  .HeaderTemplate(@<text>For Review</text>)
            .HtmlAttributes(new { style = "text-align:center;height:30px" })
            .HeaderHtmlAttributes(new { style = "text-align:center;vertical-align:middle;height:30px;background-color:#ff6a00;font-size:14px;color:beige;" });
        col.Template(@<text></text>)
            .HeaderTemplate(@<text>Expense Class</text>)
            .Hidden()
            //.HtmlAttributes(new { style = "text-align:center;" })
            .HeaderHtmlAttributes(new { style = "text-align:center;vertical-align:middle;height:30px;background-color:#ff6a00;font-size:14px;color:beige;" })
            .HtmlAttributes(new { style = "align:center;float:none;text-align:center; vertical-align: middle;" })
            //  .HeaderHtmlAttributes(new { style = "text-align:center; vertical-align: middle; overflow: visible; white-space: normal" })
            .ClientTemplate("<div>#=ooe# </div>");
         col.Template(@<text></text>)
            .HeaderTemplate(@<text>Expense Class</text>)
            .Hidden()
            //.HtmlAttributes(new { style = "text-align:center;" })
            .HeaderHtmlAttributes(new { style = "text-align:center;vertical-align:middle;height:30px;background-color:#ff6a00;font-size:14px;color:beige;" })
            .HtmlAttributes(new { style = "align:center;float:none;text-align:center; vertical-align: middle;" })
            //  .HeaderHtmlAttributes(new { style = "text-align:center; vertical-align: middle; overflow: visible; white-space: normal" })
            .ClientTemplate("<div>#=trnno# </div>");
    //
        col.Template(@<text></text>)
       //col.Bound(m => m.AccountName)
            .HeaderTemplate(@<text>Account ID</text>)
            .Hidden()
            .HtmlAttributes(new { style = "text-align:left;" })
            .HeaderHtmlAttributes(new { style = "text-align:center;vertical-align:middle;height:30px;background-color:#ff6a00;font-size:14px;color:beige;" })
            .ClientTemplate("<div>#=accountid# </div>");
        col.Template(@<text></text>)
       //col.Bound(m => m.AccountName)
            .HeaderTemplate(@<text>Account</text>)
            .Width(280)
            .HtmlAttributes(new { style = "text-align:left;" })
            .HeaderHtmlAttributes(new { style = "text-align:center;vertical-align:middle;height:30px;background-color:#ff6a00;font-size:14px;color:beige;" })
            .ClientTemplate("<div>#=AccountName# </div>");
        col.Template(@<text></text>)
                    .HeaderTemplate(@<text>Qtr</text>)
                    .Width(50)
                    .HtmlAttributes(new { style = "text-align:center;height:30px" })
                    .HeaderHtmlAttributes(new { style = "text-align:center;vertical-align:middle;height:30px;background-color:#ff6a00;font-size:14px;color:beige;" })
                    .ClientTemplate("<div>#=Qtr# </div>");
        col.Template(@<text></text>)
                    .HeaderTemplate(@<text>1st Month</text>)
                    .Width(100)
                    .HtmlAttributes(new { style = "text-align:right;height:30px" })
                    .HeaderHtmlAttributes(new { style = "text-align:center;vertical-align:middle;height:30px;background-color:#ff6a00;font-size:14px;color:beige;" })
                    .ClientTemplate("<div>#=kendo.toString(fistamount,'c2')# </div>");
        col.Template(@<text></text>)
                    .HeaderTemplate(@<text>2nd Month</text>)
                    .Width(100)
                    .HtmlAttributes(new { style = "text-align:right;height:30px" })
                    .HeaderHtmlAttributes(new { style = "text-align:center;vertical-align:middle;height:30px;background-color:#ff6a00;font-size:14px;color:beige;" })
                    .ClientTemplate("<div>#=kendo.toString(secondamount,'c2')# </div>");
        col.Template(@<text></text>)
                    .HeaderTemplate(@<text>3rd Month</text>)
                    .Width(100)
                    .HtmlAttributes(new { style = "text-align:right;height:30px" })
                    .HeaderHtmlAttributes(new { style = "text-align:center;vertical-align:middle;height:30px;background-color:#ff6a00;font-size:14px;color:beige;" })
                    .ClientTemplate("<div>#=kendo.toString(thirdamount,'c2')# </div>");
        col.Template(@<text></text>)
                    .HeaderTemplate(@<text>Transaction Date</text>)
                    .Width(165)
                    .HtmlAttributes(new { style = "text-align:left;" })
                    .HeaderHtmlAttributes(new { style = "text-align:center;vertical-align:middle;height:30px;background-color:#ff6a00;font-size:14px;color:beige;" })
                    .ClientTemplate("<div>#=datetimentered# </div>");
   
        col.Template(@<text></text>)
                    .HeaderTemplate(@<text>1st Month <br />Release</text>)
                    .Width(100)
                    .HtmlAttributes(new { style = "text-align:right;height:30px" })
                    .HeaderHtmlAttributes(new { style = "text-align:center;vertical-align:middle;height:30px;background-color:#ff6a00;font-size:14px;color:beige;" })
                    .ClientTemplate("<div>#=kendo.toString(firstmon_release,'c2')# </div>");
        col.Template(@<text></text>)
                    .HeaderTemplate(@<text>2nd Month <br />Release</text>)
                    .Width(100)
                    .HtmlAttributes(new { style = "text-align:right;height:30px" })
                    .HeaderHtmlAttributes(new { style = "text-align:center;vertical-align:middle;height:30px;background-color:#ff6a00;font-size:14px;color:beige;" })
                    .ClientTemplate("<div>#=kendo.toString(secondmon_release,'c2')# </div>");
                    
        col.Template(@<text></text>)
                    .HeaderTemplate(@<text>3rd Month <br />Release</text>)
                    .Width(100)
                    .HtmlAttributes(new { style = "text-align:right;height:30px" })
                    .HeaderHtmlAttributes(new { style = "text-align:center;vertical-align:middle;height:30px;background-color:#ff6a00;font-size:14px;color:beige;" })
                    .ClientTemplate("<div>#=kendo.toString(thirdmon_release,'c2')# </div>");
                    
        @*col.Bound(m => m.remarks)
                .HeaderTemplate(@<text>Remarks</text>)
                .HeaderHtmlAttributes(new { style = "text-align:center;vertical-align:middle;height:30px;background-color:#ff6a00;font-size:14px;color:beige;" })
               // .ClientTemplate("<div> id=remarksid </div>")
                .Width(165);*@
       // col.Command(command => command.Destroy()).Width(150);
        @*col.Template(t => { })
            .ClientTemplate(
            "<div  class='k-button k-button-icontext'  id='deleteid#=trnno#' onclick='disapprovedfppt(#=trnno#)' style='border-radius:50px;width:110px;'><span class='fa fa-thumbs-o-down'  style='font-size: 10pt;margin: 1px;margin-top: -1px;margin-left: 5px;margin-right: 3px;'></span>Disapprove</div></div>")
            .HtmlAttributes(new { style = "text-align:left;width:150px" })
            .HeaderTemplate(@<text>Disapprove</text>)
            .Width(100)
            .HeaderHtmlAttributes(new { style = "text-align:center;vertical-align:middle;height:30px;background-color:#ff6a00;font-size:14px;color:beige;" });*@

        })
            //.ToolBar(toolbar =>
            //{
            //    toolbar.Create();
            //    toolbar.Save();
            //})
            .Editable(editable => editable.Mode(GridEditMode.InCell))
            .Navigatable()
            .Pageable(pageable => pageable
            .Refresh(true)
            .Enabled(true)
            .ButtonCount(2))
            .Scrollable()
            .Selectable()
            .AutoBind(false)
            .Resizable(s => s.Columns(true))
            //.Sortable(sortable => sortable
            //.AllowUnsort(true)
            //.SortMode(GridSortMode.MultipleColumn))
            .Events(e => e.DataBound("onDataBound"))
            .DataSource(dataSource => dataSource
            .Ajax()
            .Batch(true)
            .Model(m => m.Id(i => i.trnno))
            .ServerOperation(false)

            //.Aggregates(a =>
            //{
            //    a.Add(c => c.Amount).Sum();
            //})
            .PageSize(1000)
            .Read(read => read.Action("GetDFPPTApprove", "Report").Data("getParam"))
          //  .Update("Editing_Update", "Report")
            )
    )
</div>
<div style="margin-top:45px">
    <div id="btnPrint" class="k-button k-button-icontext" style="bottom: 15px; right: 25px;width: 100px;float:right;margin-top: 20px; margin-right:230px;border-radius:50px;margin-top:-30px; margin-bottom:0px;"   onclick="reqPrintApproved()"><span class="mif-printer"></span> Preview</div>
    <div  class="k-button k-button-icontext" style="bottom: 15px; right: 25px;width: 100px;float:right;background-color:indianred; color:white; margin-top: 20px; margin-right:110px;border-radius:50px;margin-top:-30px; margin-bottom:0px" onclick="frmclose()"><span class="fa fa-close"></span> Close</div>
</div>
<script>
    $(document).ready(function(){
        $("#grd_dffptapproveoffice").data("kendoGrid").dataSource.read();
    });

    @*$(document).ready(function () {
        if (@Session["userspecialaccess"].ToString() != "0")
        {
            document.getElementById("div_forapproval").style.display = "inline";
        }
        else
        {
            document.getElementById("div_forapproval").style.display = "none";
            $("#div_close").css('margin-top','29px');
        }
    });*@

</script>