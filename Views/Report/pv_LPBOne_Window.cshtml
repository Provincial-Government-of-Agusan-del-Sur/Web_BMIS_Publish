
<script>
    var thisculture = kendo.culture();
    thisculture.numberFormat.currency.symbol = '₱';

    function dataBound() {
        this.expandRow(this.tbody.find("tr.k-master-row").first());
    }

    function GetFundID() {
        return {
            Fund_ID: '@Session["Fund_ID"]',
            Year_of: '@Session["Year_of"]'
        }
    }

    var Proposal = $("#propsYears").val();
    var Estimate = Proposal - 1;
    var Actual = Proposal - 2;
    document.getElementById("Proposals").innerHTML = Proposal;
    document.getElementById("Estimates").innerHTML = Estimate;
    document.getElementById("Actuals").innerHTML = Actual;
    document.getElementById("Differences").innerHTML = Proposal + ' - ' + Estimate;
    


    function reqADDType() {
        var url = "@Url.Action("NewType", "Report")";
        $.get(url, { Fund_ID: '@Session["Fund_ID"]', Year_of: '@Session["Year_of"]' }, function (d) {
            $('#newAccounts22').html(d);
        })
        $('#newAccounts22').data('kendoWindow').title("<i class='fa fa-navicon'> </i>").center().open();
    }

    function reqAddSub(Type_ID) {
        var url = "@Url.Action("NewSubbAdd", "Report")";
        //alert("ahhhhhhhhhh")
        $.get(url, { Type_ID: Type_ID, Year_Of: '@Session["Year_of"]' }, function (d) {
            $('#newAccounts').html(d);
        })
        $('#newAccounts').data('kendoWindow').title("<i class='fa fa-navicon'> </i>").center().open();
    }

    function reqDeleteTy(e) {
        var url = "@Url.Action("RemoveTY", "Report")";
        var Year_of = $("#propsYears").val()

        swal({
            title: "System Notice!",
            text: "This will remove your Revenue. This Action can't be undone. Are you sure you want to Proceed?",
            type: "warning",
            showCancelButton: true,
            confirmButtonColor: "#DD6B55",
            confirmButtonText: "Yes",
            cancelButtonText: "Cancel",
            closeOnConfirm: false
        }, function () {
            $.get(url, { Type_ID: e, Year_of: '@Session["Year_of"]' }, function (d) {
                if (d == "success") {
                    swal({
                        title: "Success!",
                        text: "Successfully Remove.",
                        timer: 2000,
                        type: "success",
                        showConfirmButton: false
                    })
                    $('#Typegrid').data('kendoGrid').dataSource.read();
                } else {
                    swal({
                        title: "Error!",
                        text: "System Error! Please try again.",
                        timer: 2000,
                        type: "error",
                        showConfirmButton: false
                    })
                }

            });
        });

    }

    function reqDeleteSub(Sub2_ID) {
        var url = "@Url.Action("RemoveSubs", "Report")";
        var Year_of = $("#propsYears").val()

        swal({
            title: "System Notice!",
            text: "This will remove your Revenue. This Action can't be undone. Are you sure you want to Proceed?",
            type: "warning",
            showCancelButton: true,
            confirmButtonColor: "#DD6B55",
            confirmButtonText: "Yes",
            cancelButtonText: "Cancel",
            closeOnConfirm: false
        }, function () {
            $.get(url, { Sub2_ID: Sub2_ID, Year_of: '@Session["Year_of"]' }, function (d) {
                if (d == "success") {
                    swal({
                        title: "Success!",
                        text: "Successfully Remove.",
                        timer: 2000,
                        type: "success",
                        showConfirmButton: false
                    })
                    $('#Typegrid').data('kendoGrid').dataSource.read();
                } else {
                    swal({
                        title: "Error!",
                        text: "System Error! Please try again.",
                        timer: 2000,
                        type: "error",
                        showConfirmButton: false
                    })
                }

            });
        });

    }
    function reqEditSub(Sub2_ID,TypeID) {
        var url = "@Url.Action("editSubs", "Report")";
        // alert(Sub2_ID)
        $.get(url, { Sub2_ID: Sub2_ID, Year_of: '@Session["Year_of"]', TypeID: TypeID }, function (d) {
            $('#newAccounts').html(d);
        })
        $('#newAccounts').data('kendoWindow').title("<i class='fa fa-navicon'> </i>").center().open();
    }
</script>

<div style="border: outset;clear:both;border-width:1px;border-color:#1fa67a; width: 960px; padding-left:0px;padding-right:0px;padding-top:0px;padding-bottom:7px;margin-top: 10px;">
    <div style=" width: 0;height: 0; border-right: 5px solid #333333; border-bottom: 37px solid #333333; border-left: 65px solid #333333;margin-top: -1px;margin-bottom: 0px; ">
        <div style="float: left; width: 895px; margin-top:1px;margin-bottom:-97px;margin-left:-33px; height: 0; border-left: 35px solid #333333; border-bottom: 36px solid #1fa67a; ">

            <div style="float: left; height:28px; margin-left:-59px; margin-top: 5px;">
                <i class="fa fa-tasks fa-2x fg-white">  &nbsp;&nbsp; </i>
                <script>
                    function refreshGrid() {
                        $("#SourceFundsGrid").data("kendoGrid").dataSource.read();
                    }
                </script>
            </div>
            <div class="k-button" onclick="reqADDType()" style="float: right;margin-bottom: 0px;margin-top:3px;margin-right: 30px">
                <span class="k-icon k-i-plus" style="margin-left: -2px;margin-right: 3px;margin-top: 0px;"></span>
                ADD Revenue

            </div>

            @*<div style="float: right;margin-right:10px;margin-top:2px;">
                    <i class="fa fa-calendar fa-2x #33333"></i>
                </div>*@

        </div>

    </div>
    @(Html.Kendo().Grid<iFMIS_BMS.BusinessLayer.Models.LBPOne_TypeFundsModel>()
        .Name("Typegrid")
        .Columns(columns =>
        {
            columns.Bound(e => e.Type_ID).Hidden();
            columns.Bound(e => e.Type_Desc).Width(160).Title("Particular")
                  .ClientFooterTemplate("TOTAL"); 
            columns.Bound(e => e.Year1_Amount).Width(90)
                .HeaderTemplate(@<text><div style="font-weight:600;">Past Year<br><span id="Actuals"></span><br>(Actual)</div></text>)
                .ClientFooterTemplate("#=kendo.toString(sum, 'c2')#");
            columns.Bound(e => e.Year2_Amount).Width(90)
                .HeaderTemplate(@<text><div style="font-weight:600;">Current Year<br><span id="Estimates"></span><br>(Estimate)</div></text>)
                .ClientFooterTemplate("#=kendo.toString(sum, 'c2')#");
            columns.Bound(e => e.Year3_Amount).Width(90)
                .HeaderTemplate(@<text><div style="font-weight:600;">Budget Year<br><span id="Proposals"></span><br>(Proposal)</div></text>)
                .ClientFooterTemplate("#=kendo.toString(sum, 'c2')#");
            columns.Bound(e => e.Difference).Width(90)
                .HeaderTemplate(@<text><div style="font-weight:600;">Difference<br><span id="Differences"></span></div></text>)
                .ClientFooterTemplate("#=kendo.toString(sum, 'c2')#");
            columns.Template(t => { }).ClientTemplate(
                //"<div class='k-button' title='View Accounts' onclick='reqEdit(#=Fund_ID#)'><span class='fa fa-edit' style='width: 10px'> </span></div> " +
                //"<div class='k-button' title='View Accounts' onclick='reqEdit(#=Fund_ID#)'><span class='fa fa-close' style='width: 10px'> </span></div>"
                                     "<div class='btn-delete'style='inline-block; height: 15px;width:65px;margin-left:30px;'> " +
                //"<a  title='Submit' onclick='reqEdit(#=Fund_ID#)' style='margin-left:2px;'><span class='fa fa-search-plus' style='font-size: 12pt;'></span></a>" +
                                      "<a  title='remove' onclick='reqDeleteTy(#=Type_ID#)' style='margin-left:2px;'><span class='fa fa-remove' style='font-size: 12pt;'></span></a>" +
                                      " </div>"
                                    ).HtmlAttributes(new { style = "vertical-align: top;" }).Width(70);

            columns.Bound(e => e.Year_Of).Hidden();
        })

                            .Sortable()
                            .Pageable()
                            .Scrollable()
                            .ClientDetailTemplateId("template")
                            .HtmlAttributes(new { style = "height:600px;" })
                            .DataSource(dataSource => dataSource

                                .Ajax()
                                .PageSize(6)
                                                 .Aggregates(aggregates =>
                                                                        {

                                                                            aggregates.Add(p => p.Year1_Amount).Sum();
                                                                            aggregates.Add(p => p.Year2_Amount).Sum();
                                                                            aggregates.Add(p => p.Year3_Amount).Sum();
                                                                            aggregates.Add(p => p.Difference).Sum();
                                                                            
                                                                        })
                                .Read(read => read.Action("ReadTF", "Report").Data("GetFundID"))
                            )
        //.Events(events => events.DataBound("dataBound"))
)
    <script>
        function onLoadgrdTemplate() {
            document.getElementById("tProposal").innerHTML = Proposal;
            document.getElementById("tEstimate").innerHTML = Estimate;
            document.getElementById("tActual").innerHTML = Actual;
            document.getElementById("tDifference").innerHTML = Proposal + ' - ' + Estimate;
        }
    </script>
    <script id="template" type="text/kendo-tmpl">
        @(Html.Kendo().Grid<iFMIS_BMS.BusinessLayer.Models.LBPOne_Sub2Model>()
            .Name("grid_#=Type_ID#") // template expression, to be evaluated in the master context
            .Columns(columns =>
            {
                columns.Bound(o => o.Sub2_ID).Hidden();
                columns.Bound(o => o.Sub1_Desc).Hidden()
                    .ClientGroupHeaderTemplate("\\#=value\\#");

                columns.Bound(o => o.Sub2_Desc).Width(160).Title("Sub Description")
                     .ClientGroupFooterTemplate("Total")
                     .ClientFooterTemplate("#=Type_Desc#");

                columns.Bound(o => o.Year1_Amount).Width(90)
                    .HeaderTemplate(@<text>
                        <div style="font-weight:600;">Past Year<br><span id="tActual"></span><br>(Actual)</div></text>)
                     .ClientGroupFooterTemplate("\\#=kendo.toString(sum, 'c2')\\#")
                     .ClientFooterTemplate("\\#=kendo.toString(sum, 'c2')\\#");
                columns.Bound(o => o.Year2_Amount).Width(90)
                     .HeaderTemplate(@<text>
                        <div style="font-weight:600;">Current Year<br><span id="tEstimate"></span><br>(Estimate)</div></text>)
                    .ClientGroupFooterTemplate("\\#=kendo.toString(sum, 'c2')\\#")
                    .ClientFooterTemplate("\\#=kendo.toString(sum, 'c2')\\#");
               
                columns.Bound(o => o.Year3_Amount).Width(90)
                    .HeaderTemplate(@<text><div style="font-weight:600;">Budget Year<br><span id="tProposal"></span><br>(Proposal)</div></text>)
                    .ClientGroupFooterTemplate("\\#=kendo.toString(sum, 'c2')\\#")
                    .ClientFooterTemplate("\\#=kendo.toString(sum, 'c2')\\#");
                columns.Bound(e => e.Difference).Width(90)
                     .HeaderTemplate(@<text>
                        <div style="font-weight:600;">Difference<br><span id="tDifference"></span></div></text>)
                    .ClientGroupFooterTemplate("\\#=kendo.toString(sum, 'c2')\\#")
                    .ClientFooterTemplate("\\#=kendo.toString(sum, 'c2')\\#");
                columns.Template(t => { }).ClientTemplate(
                                  // "<div class='k-button' title='View Accounts' onclick='reqEdit(#=Fund_ID#)'><span class='fa fa-edit' style='font-size: 10pt;margin: 1px;margin-top: -1px;margin-left: 5px;margin-right: 3px;'> </span></div>"
                                    "<div class='btn-delete'style='inline-block; height: 15px;width:65px;margin-left:30px;'> " +
                                        "<a  title='View Details' onclick='reqEditSub(\\#=Sub2_ID\\#,#=Type_ID#)' style='margin-left:2px;'><span class='fa fa-edit' style='font-size: 12pt;'></span></a>" +
                                      "<a  title='remove' onclick='reqDeleteSub(\\#=Sub2_ID\\#)' style='margin-left:2px;'><span class='fa fa-remove' style='font-size: 12pt;'></span></a>" +
                                      " </div>"
                                  ).HtmlAttributes(new { style = "vertical-align: top;" }).Width(70);
            })
            .Events(e => e.DataBound("onLoadgrdTemplate"))

             .ToolBar(t => t.Template(@<text>
                <div class="k-button" onclick="reqAddSub('#=Type_ID#')" style="float: right;margin-bottom: 0px;">
                    <span class="k-icon k-i-plus" style="margin-left: -2px;margin-right: 3px;margin-top: 0px;"></span>
                    ADD Subs

                </div>
            </text>))
                                        .DataSource(dataSource => dataSource
                                            .Ajax()
                                            .PageSize(10)
                                            .Model(m => m.Id(i => i.Sub1_ID))
                                                    .Aggregates(aggregates =>
                                                                {
                                                                   
                                                                    aggregates.Add(p => p.Year1_Amount).Sum();
                                                                    aggregates.Add(p => p.Year2_Amount).Sum();
                                                                    aggregates.Add(p => p.Year3_Amount).Sum();
                                                                    aggregates.Add(p => p.Difference).Sum();
                                                                })
                                              .Read(read => read.Action("readSub", "Report", new { Type_ID = "#=Type_ID#", Year_Of = "#=Year_Of#" }))
                                              //.Update(update => update.Action("EditingInline_Update", "Report"))
                                              .Group(g => g.Add(c => c.Sub1_Desc))
                                        )
                                        .Pageable()
                                        .Sortable()
                                        
                                        .ToClientTemplate()
        )
    </script>
</div>
@(Html.Kendo().Window()
    .Name("newAccounts")
    .Title("Propose Account")
    .Width(600)
    .Height(310)
    .Visible(false)
    .Modal(true)
    .Draggable(false)
    .AutoFocus(true)
    .Animation(a =>
        {
            a.Open(o => o.SlideIn(SlideDirection.Down));
            a.Close(c =>
            {
                c.SlideIn(SlideDirection.Down);
                c.Reverse(true);
            });

        }).Actions(a => { a.Close(); }))
@(Html.Kendo().Window()
    .Name("newAccounts22")
    .Title("Propose Account")
    .Width(600)
    .Height(210)
    .Visible(false)
    .Modal(true)
    .Draggable(false)
    .AutoFocus(true)
    .Animation(a =>
        {
            a.Open(o => o.SlideIn(SlideDirection.Down));
            a.Close(c =>
            {
                c.SlideIn(SlideDirection.Down);
                c.Reverse(true);
            });

        }).Actions(a => { a.Close(); }))

