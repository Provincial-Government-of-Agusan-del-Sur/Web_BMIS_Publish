<script>
    function fnofficestatus() {
        officeid = @Account.UserInfo.Department;
    }

    function fn_refresher(e) {
        var SelectedTabIndex = $("#grid_wfpstatus_tabstrip").data("kendoTabStrip").select().index();
        if (SelectedTabIndex == 0) {
            if ($("#chkwfpperitem").val() == 0){
                $("#grid_wfpstatusreview").data("kendoGrid").dataSource.read();
            }
            else{
                $("#grid_wfpstatusreviewperitem").data("kendoGrid").dataSource.read();   
            }
        }
        else {
            $("#grid_wfpreroute").data("kendoGrid").dataSource.read();
        }
    }
    function fnOffice_rev_sel(){
        var wfpperitem=$("#chkwfpperitem").val()
        if (wfpperitem ==0){
            $("#grid_wfpstatusreview").data("kendoGrid").dataSource.read()
        }
        else{
            $("#grid_wfpstatusreviewperitem").data("kendoGrid").dataSource.read()
        }
    }
    function onclk_wfpperitem(){
        if (document.getElementById("chkwfpperitem").checked){
            $("#chkwfpperitem").val(1)
            $("#grid_wfpstatusreviewperitem").data("kendoGrid").dataSource.read();   
            $("#wfpsummaryid").hide()
            $("#wfpsummaryid_peritem").show()
            document.getElementById("wfpsummaryid_peritem").style = 'display:inline-block;width:100%;margin-top:-3px;'
            $("#btnreloadid").show()
        }
        else{
            $("#chkwfpperitem").val(0)
            $("#grid_wfpstatusreview").data("kendoGrid").dataSource.read();
            $("#wfpsummaryid").show()
            $("#wfpsummaryid_peritem").hide()
            document.getElementById("wfpsummaryid").style = 'display:inline-block;width:100%;margin-top:-3px;'
            $("#btnreloadid").hide()
        }
    }
    function lbl_wfpperitem(){
        if (document.getElementById("chkwfpperitem").checked){
            document.getElementById("chkwfpperitem").checked = false
            document.getElementById("chkwfpperitem").value = 0
            $("#grid_wfpstatusreview").data("kendoGrid").dataSource.read();
            $("#wfpsummaryid").show()
            $("#wfpsummaryid_peritem").hide()
            document.getElementById("wfpsummaryid").style = 'display:inline-block;width:100%;margin-top:-3px;'
            $("#btnreloadid").hide()
        }
        else{
            document.getElementById("chkwfpperitem").checked = true
            document.getElementById("chkwfpperitem").value = 1
            $("#grid_wfpstatusreviewperitem").data("kendoGrid").dataSource.read();   
            $("#wfpsummaryid").hide()
            $("#wfpsummaryid_peritem").show()
            document.getElementById("wfpsummaryid_peritem").style = 'display:inline-block;width:100%;margin-top:-3px;'
            $("#btnreloadid").show()
        }
    }
</script>

<label style="display:inline-block;margin-left:0px;margin-top:10px;">
    Office
</label>
<div style="margin-left:0px;width:500px;">
    @(Html.Kendo().ComboBox()
            .Name("officestatus")
            .DataTextField("offname")
            .DataValueField("OfficeID")
            .AutoBind(true)
            .Placeholder("Select Office...")
            .Filter("contains")
            .MinLength(3)
            .Events(e => e.Change("fnOffice_rev_sel"))
            .SelectedIndex(-1)
            .HtmlAttributes(new { style = "width:100%; height:100%", @class = "form-control autoselect" })
            .DataSource(source =>
            {
                source.Read(read =>
                {
                    read.Action("GetOfficeWFP", "Report").Data("fnofficestatus");
                })
            .ServerFiltering(false);
            })
    )
    <div id="btnreloadid" style="float:right;margin-top:-40px;margin-right:-77px">
        <div id="btnSave" class="k-button k-button-icontext" style="bottom: 15px; right: 25px;width: 75px;float:left; margin-top: 10px; margin-left:15px;border-radius:50px;background-color:cornflowerblue;color:white; margin-bottom:0px" onclick="reloadperitem(1)"><span class="fa fa-refresh"></span> Reload</div>
    </div>
</div>

<div style="display:inline-block">
    <input type="checkbox" value="0" id="chkwfpperitem" style="zoom:1.2;margin-left:2px;" onclick="onclk_wfpperitem()"/>
    <label style="display:inline-block;font-size:14px;color:cornflowerblue" onclick="lbl_wfpperitem()" >View Per Item</label>
</div>
<div class="demo-section k-content">
    @(Html.Kendo().TabStrip()
          .Name("grid_wfpstatus_tabstrip")
          .Navigatable(false)
          .Animation(animation =>
              animation.Open(effect =>
              effect.Fade(FadeDirection.In)))
          .Items(tabstrip =>
          {
              tabstrip.Add().Text("Regular").Selected(true).LoadContentFrom("wfpstatus_review_regular", "Report");
              tabstrip.Add().Text("Reroute").LoadContentFrom("wfpstatus_review_reroute", "Report");
          })
          .Events(e => e.Activate("fn_refresher"))

    )
</div>

<script>
    $(document).ready(function () {
        $("#btnreloadid").hide()
    })
    function reloadperitem(id){
        var chkperitem =$("#chkwfpperitem").val()
        var officeid=$("#officestatus").val()
        var year=$("#wfpyear").val()

        swal({
            title: "It will only take a few seconds to reload the WFP items. Would you like to continue?",
            type: "warning",
            showCancelButton: true,
            confirmButtonColor: "#DD6B55",
            confirmButtonText: status,
            closeOnConfirm: false,
            showLoaderOnConfirm: true
        },
            function (isConfirm) {
                if (isConfirm) {
                    var url = "@Url.Action("ReloadWFPItems", "Report")";
                    $.get(url, { officeid: officeid,year:year,reload : id }, function (e) {

                        if (e == "success") {
                            swal("Success", "The WFP items have been reloaded successfully.", "success");
                            $("#grid_wfpstatusreviewperitem").data("kendoGrid").dataSource.read();   
                        } else {
                            swal("Warning", e, "warning");
                        }
                    });
                }
            });
        
    }
</script>